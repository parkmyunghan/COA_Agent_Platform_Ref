# 시스템 아키텍처

## 1. 개요

Defense Intelligent Agent Platform은 온톨로지 기반 지식 표현과 AI 에이전트 기술을 활용한 군사 의사결정 지원 시스템입니다.

### 핵심 설계 원칙

- **레이어 분리**: Data, Orchestration, Agent, Command 레이어로 명확히 구분
- **현대적 웹 스택**: React (Frontend) + FastAPI (Backend) 구조 채택
- **단일 책임**: 각 컴포넌트는 명확한 역할과 책임을 가짐
- **확장 가능**: 새로운 Agent나 기능 추가가 용이한 구조
- **투명성**: 추론 과정과 근거를 시각적으로 제시

---

## 2. 전체 아키텍처

### 2.1 레이어 구조

```
┌─────────────────────────────────────────────────────────┐
│  Command Layer (전술 상황도)                                │
│  - Frontend (React 18 + Vite)                            │
│  - UI Components (Shadcn UI, Tailwind CSS)               │
│  - Visualization (OpenLayers Map, Force Graph)           │
│  - State Management (React Hooks, Axios)                 │
└─────────────────────────────────────────────────────────┘
                        ↓ ↑ (REST API / JSON)
┌─────────────────────────────────────────────────────────┐
│  API/Orchestration Layer (시스템 조율)                     │
│  - Backend (FastAPI, Uvicorn)                            │
│  - API Routers (System, COA, Analytics, Docs)            │
│  - WebSocket (Real-time Updates)                         │
└─────────────────────────────────────────────────────────┘
                        ↓ ↑
┌─────────────────────────────────────────────────────────┐
│  Agent Layer (지능형 에이전트)                            │
│  - COA 추천 엔진 (EnhancedCOAEngine)                     │
│    ├─ 전술 상황 분석 (METT-C 반영)                         │
│    ├─ 방책 후보 생성 (Adaptation)                          │
│    └─ LLM 협력 추론                                       │
│  - LLM Manager (RAG 기반 근거 생성)                        │
│  - 적응형 점수 계산기 (COA Scorer - 7개 요소)               │
│  - 시맨틱 추론기 (SPARQL Interpreter)                      │
└─────────────────────────────────────────────────────────┘
                        ↓ ↑
┌─────────────────────────────────────────────────────────┐
│  Data Layer (전술 데이터 레이어)                          │
│  - 데이터 관리자 (Data Manager)                            │
│  - 온톨로지 고도화 엔진 (16개 테이블 연동)                    │
│  - 시맨틱 임베딩 엔진                                      │
│  - 전술 지식그래프 (RDF/TTL)                               │
│  - 벡터 지식베이스 (FAISS)                                  │
└─────────────────────────────────────────────────────────┘
```

### 2.2 다이어그램

인터랙티브 시각화 다이어그램은 `docs/system_architecture.html`에서 확인할 수 있습니다.

---

## 3. 주요 컴포넌트

### 3.1 Data Layer (전술 데이터 레이어)

#### DataManager
- **위치**: `core_pipeline/data_manager.py`
- **역할**: 16개 핵심 엑셀 파일 로드 및 전처리
- **주요 메서드**:
  - `load_all()`: 모든 데이터 테이블 일괄 로드
  - `load_table()`: 특정 전술 테이블(예: 위협상황) 로드

#### EnhancedOntologyManager
- **위치**: `core_pipeline/ontology_manager_enhanced.py`
- **역할**: 전술 데이터를 시맨틱 삼중항(Triple)으로 변환 및 복합 관계 추론
- **주요 기능**:
  - 16개 테이블 간의 교리적 관계 매핑
  - SPARQL 기반 전술 경로 추론

#### RAGManager
- **위치**: `core_pipeline/rag_manager.py`
- **역할**: 군사 교범(PDF/Text) 기반 시맨틱 검색
- **주요 기능**:
  - 문서 조각(Chunk) 임베딩 및 FAISS 저장
  - 현재 상황과 유사한 과거 사례/교리 검색

---

### 3.2 Agent Layer (지능형 에이전트)

#### EnhancedCOAEngine
- **위치**: `core_pipeline/coa_service.py` (`generate_coas_unified`)
- **역할**: 임무/위협 중심의 통합 방책 추천 시스템
- **주요 기능**:
  - `generate_coas_unified()`: 상황별(임무/위협) 최적 방책 생성
  - 전장축선별 위협 수준 분석 및 대응 전략 수립

#### LLMManager
- **위치**: `core_pipeline/llm_manager.py`
- **역할**: 자연어 처리 및 전략적 판단 근거 생성
- **지원 모델**: OpenAI GPT-4o, Local LLM 등

#### COAScorer
- **위치**: `core_pipeline/coa_scorer.py`
- **역할**: 상황 적응형 가중치(Adaptive Weights) 기반 다중 요소 평가
- **평가 요소**: 위협대응, 자원가용성, 전력능력, 환경적합성, 효과성, 연계성, 임무부합성 (7개)

---

### 3.3 Command Layer (전술 상황도)

#### React Dashboard Application
- **위치**: `frontend/src/`
- **기술**: React 18, Vite, TypeScript
- **주요 페이지**:
  - `pages/CommandControlPage.tsx`: 통합 지휘통제 및 방책 추천 화면
  - `pages/OntologyStudioPage.tsx`: 지식 그래프 탐색 및 규칙 실행 도구
  - `pages/KnowledgeGraphPage.tsx`: 지식 그래프 시각화 및 관계 추적
  - `pages/DataManagementPage.tsx`: 데이터 테이블 및 RAG 지식 베이스 관리
  - `pages/LearningGuidePage.tsx`: 시스템 도움말 및 가이드

---

## 4. 데이터 흐름

### 4.1 핵심 워크플로우

1. **상황 입력**: React 대시보드의 `SituationInputPanel`에서 위협 선택, SITREP 입력 또는 시나리오 로드
2. **요청 처리**: FastAPI Orchestrator가 요청을 수신하여 `COAService` 호출
3. **상황 분석**: `AxisStateBuilder`가 16개 테이블 연동 지상 상태 구축 및 RAG 검색 수행
4. **방책 생성**: `COAGenerator` (온톨로지/RAG 기반 후보 생성) 및 LLM 적응화
5. **평가 및 정렬**: `COAScorer`가 7대 요소 평가 후 상위 방책 선정
6. **결과 시각화**: `TacticalMap` 화면에 방책 실행 계획 및 MIL-STD-2525 심볼 표출

### 4.2 데이터 소스 (16개 엑셀 테이블)

**데이터 레이크 (`data_lake/`)**:
- **전술 기동**: `전장축선.xlsx`, `지형셀.xlsx`
- **부대 현황**: `아군부대현황.xlsx`, `적군부대현황.xlsx`
- **임무/위협**: `임무정보.xlsx`, `위협상황.xlsx`, `위협유형_마스터.xlsx`
- **자원/평가**: `아군가용자산.xlsx`, `임무별_자원할당.xlsx`, `평가기준_가중치.xlsx`
- **기타**: `기상정보.xlsx`, `민간시설.xlsx`, `제약조건.xlsx`, `COA_Library.xlsx` 등

---

## 5. 기술 스택

### 5.1 백엔드
- **Language**: Python 3.12+
- **Framework**: FastAPI
- **Logic**: RDFLib (Ontology), FAISS (VectorDB), Pydantic (Schema)

### 5.2 프론트엔드
- **Framework**: React 18+ (TS)
- **Build Tool**: Vite
- **Ui Library**: Ant Design / Shadcn UI
- **Visualization**: OpenLayers, React-Force-Graph

---

## 6. 확장성

### 6.1 새로운 Agent 추가

1. `agents/` 폴더에 새 Agent 클래스 생성
2. `BaseAgent`를 상속
3. `config/agent_registry.yaml`에 등록

### 6.2 새로운 데이터 소스 추가

1. `data_lake/`에 Excel 파일 추가
2. `core_pipeline/data_loaders/`에 로더 추가 (선택적)
3. `metadata/ontology_config.xlsx`에 스키마 등록

---

## 7. 참고 자료

- `docs/방책추천_시스템.md`: 방책 추천 시스템 상세 설명
- `docs/점수_산정_시스템.md`: 점수 산정 시스템 상세 설명
- `docs/온톨로지_설계.md`: 온톨로지 구조 설명
- `docs/system_architecture.html`: 인터랙티브 다이어그램

---

**작성일**: 2026년 1월  
**최종 업데이트**: React/FastAPI Re-platforming 반영 완료  
**버전**: 2.5

