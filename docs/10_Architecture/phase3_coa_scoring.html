<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 3: COA Generation & Scoring (ë°©ì±… ìƒì„± ë° ì ìˆ˜ ì‚°ì •)</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Malgun Gothic', 'Segoe UI', sans-serif;
            line-height: 1.6;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #1976D2;
            border-bottom: 3px solid #1976D2;
            padding-bottom: 10px;
        }

        h2 {
            color: #0288D1;
            margin-top: 30px;
            border-left: 4px solid #0288D1;
            padding-left: 10px;
        }

        h3 {
            color: #0277BD;
        }

        .diagram-container {
            background: #fafafa;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .step-box {
            background: #e3f2fd;
            border-left: 4px solid #1976D2;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .code-block {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
        }

        .info-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .warning-box {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .formula-box {
            background: #f1f8e9;
            border: 2px solid #8bc34a;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #1976D2;
            color: white;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', monospace;
        }

        .highlight {
            background: #ffeb3b;
            padding: 2px 4px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>âš”ï¸ Phase 3: COA Generation & Scoring (ë°©ì±… ìƒì„± ë° ì ìˆ˜ ì‚°ì •)</h1>

        <div class="info-box">
            <strong>Phase ê°œìš”</strong><br />
            Phase 2ì—ì„œ ë¶„ì„í•œ ìƒí™© ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì˜¨í†¨ë¡œì§€ ê·¸ë˜í”„ ë° COA ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì í•©í•œ ë°©ì±… í›„ë³´ë¥¼ ê²€ìƒ‰í•˜ê³ ,
            **ë‹¤ì¤‘ ê¸°ì¤€(Multi-Criteria)** ì ìˆ˜ ì‚°ì •ì„ í†µí•´ ìµœì  ë°©ì±…ì„ ì„ ë³„í•©ë‹ˆë‹¤.
            íŒ”ë€í‹°ì–´ ë°©ì‹ì˜ ë°ì´í„° ê¸°ë°˜ ì ìˆ˜ ê³„ì‚°ê³¼ ë‹¤ì–‘ì„± í•„í„°ë§ì„ í†µí•´ ì§€íœ˜ê´€ì—ê²Œ ë‹¤ê°ì  ì „ìˆ  ëŒ€ì•ˆì„ ì œì‹œí•©ë‹ˆë‹¤.
        </div>

        <h2>ğŸ”„ ì „ì²´ í”„ë¡œì„¸ìŠ¤ íë¦„</h2>
        <div class="diagram-container">
            <div class="mermaid">
                graph TB
                Start([Phase 3 ì‹œì‘]) --> TypeLoop{ë°©ì±… ìœ í˜•ë³„<br />ë³‘ë ¬ ì²˜ë¦¬}

                TypeLoop -->|Defense| Search1[1. COA ê²€ìƒ‰<br />_search_strategies]
                TypeLoop -->|Offensive| Search2[1. COA ê²€ìƒ‰]
                TypeLoop -->|Counter_Attack| Search3[1. COA ê²€ìƒ‰]

                Search1 --> SPARQLCheck{ì˜¨í†¨ë¡œì§€<br />SPARQL ê²€ìƒ‰}
                Search2 --> SPARQLCheck
                Search3 --> SPARQLCheck

                SPARQLCheck -->|ì„±ê³µ| SPARQLResult[SPARQL ê¸°ë°˜<br />COA ì¶”ì¶œ]
                SPARQLCheck -->|ì‹¤íŒ¨| ExcelFallback[ì—‘ì…€ ê¸°ë°˜<br />í‚¤ì›Œë“œ ë§¤ì¹­]

                SPARQLResult --> Filtering[2. ìœ í˜•/ìœ„í˜‘<br />í•„í„°ë§]
                ExcelFallback --> Filtering

                Filtering --> ScoreMode{ì ìˆ˜ ê³„ì‚°<br />ëª¨ë“œ}

                ScoreMode -->|Palantir Mode| PalantirScore[3A. íŒ”ë€í‹°ì–´ ì ìˆ˜<br />_score_with_palantir_mode]
                ScoreMode -->|Basic Mode| BasicScore[3B. ê¸°ë³¸ ì ìˆ˜<br />_score_strategies]

                PalantirScore --> COAScorer[COAScorer.calculate_score<br />7ê°œ ìš”ì†Œ ì ìˆ˜ ì‚°ì •]
                BasicScore --> SimpleCal[ê°„ë‹¨ ì ìˆ˜ ê³„ì‚°]

                COAScorer --> Factors{ì ìˆ˜ ìš”ì†Œ}
                Factors --> F1[ìœ„í˜‘ ëŒ€ì‘ì„±]
                Factors --> F2[ìì› ê°€ìš©ì„±]
                Factors --> F3[ì „ë ¥ ëŠ¥ë ¥]
                Factors --> F4[í™˜ê²½ ì í•©ì„±]
                Factors --> F5[ê³¼ê±° ì„±ê³µë¥ ]
                Factors --> F6[ì¶”ë¡  ì²´ì¸]
                Factors --> F7[ì„ë¬´ ë¶€í•©ì„±]

                F1 --> Aggregate[ê°€ì¤‘ì¹˜ ì ìš©<br />ì¢…í•© ì ìˆ˜ ê³„ì‚°]
                F2 --> Aggregate
                F3 --> Aggregate
                F4 --> Aggregate
                F5 --> Aggregate
                F6 --> Aggregate
                F7 --> Aggregate
                SimpleCal --> Aggregate

                Aggregate --> Reason[4. ì¶”ì²œì‚¬ìœ  ìƒì„±<br />_generate_recommendation_reason]

                Reason --> Merge[5. ëª¨ë“  ìœ í˜•<br />ê²°ê³¼ ë³‘í•©]

                Merge --> Sort[6. ì ìˆ˜ ë‚´ë¦¼ì°¨ìˆœ<br />ì •ë ¬]

                Sort --> Diversity[7. ë‹¤ì–‘ì„± í•„í„°ë§<br />Multi-Perspective Logic]

                Diversity --> Priority1[ìš°ì„ ìˆœìœ„1:<br />ì‘ì „ ìµœì ì•ˆ]
                Diversity --> Priority2[ìš°ì„ ìˆœìœ„2:<br />ì£¼ë„ê¶Œ í™•ë³´]
                Diversity --> Priority3[ìš°ì„ ìˆœìœ„3:<br />ì°¨ìˆœìœ„ ìµœì ]

                Priority1 --> Output([Phase 3 ì™„ë£Œ<br />Top-3 COA ë°˜í™˜])
                Priority2 --> Output
                Priority3 --> Output

                style Start fill:#4CAF50,color:#fff
                style Output fill:#2196F3,color:#fff
                style COAScorer fill:#FF9800,color:#fff,stroke-width:3px
                style Diversity fill:#9C27B0,color:#fff
            </div>
        </div>

        <h2>ğŸ“‹ ë‹¨ê³„ë³„ ìƒì„¸ ì„¤ëª…</h2>

        <div class="step-box">
            <h3>Step 1: COA í›„ë³´ ê²€ìƒ‰</h3>
            <p><strong>í•¨ìˆ˜</strong>: <code>_search_strategies(situation_info, coa_type)</code></p>
            <p><strong>ê²€ìƒ‰ ë°©ë²•</strong> (ìš°ì„ ìˆœìœ„):</p>
            <ol>
                <li><strong>SPARQL ê¸°ë°˜ ê²€ìƒ‰</strong> (ì˜¨í†¨ë¡œì§€ ê·¸ë˜í”„ ì‚¬ìš©)</li>
                <li><strong>ì—‘ì…€ í‚¤ì›Œë“œ ë§¤ì¹­</strong> (í´ë°±)</li>
            </ol>

            <h4>1-1. SPARQL ê¸°ë°˜ ê²€ìƒ‰ (<code>_search_strategies_via_sparql</code>)</h4>
            <div class="code-block">
                # SPARQL ì¿¼ë¦¬ ì˜ˆì‹œ: ìœ„í˜‘ ìœ í˜•ì— countersThreat ê´€ê³„ê°€ ìˆëŠ” COA ì¡°íšŒ
                SELECT ?coa ?name ?type ?description
                WHERE {
                ?coa a ns:COA .
                ?coa ns:countersìœ„í˜‘ ?threat .
                ?threat ns:ìœ„í˜‘ìœ í˜• "Air Assault" .
                ?coa rdfs:label ?name .
                ?coa ns:ë°©ì±…ìœ í˜• ?type .
                OPTIONAL { ?coa ns:ì„¤ëª… ?description }
                }
            </div>

            <h4>1-2. ì—‘ì…€ í‚¤ì›Œë“œ ë§¤ì¹­</h4>
            <ul>
                <li><code>COA_Library.xlsx</code> í…Œì´ë¸”ì—ì„œ ê²€ìƒ‰</li>
                <li>ìœ„í˜‘ ìœ í˜•ê³¼ ì„¤ëª…/í‚¤ì›Œë“œ í•„ë“œ ë§¤ì¹­</li>
                <li>ë¯¸ë¦¬ ì •ì˜ëœ <code>coa_type</code> í•„í„° ì ìš© (Defense, Offensive ë“±)</li>
            </ul>
            <div class="code-block">
                # ì½”ë“œ ì˜ˆì‹œ (logic_defense_enhanced.py ë¼ì¸ 1951-2100)
                # 1. COA_Library í…Œì´ë¸” ë¡œë“œ
                df_library = data_cache['COA_Library']

                # 2. ë°©ì±… ìœ í˜• í•„í„°
                if coa_type:
                type_mapping = {"defense": "Defense", "offensive": "Offensive", ...}
                df_filtered = df_library[df_library['ë°©ì±…ìœ í˜•'] == type_mapping[coa_type]]

                # 3. í‚¤ì›Œë“œ ë§¤ì¹­ (ìœ„í˜‘ ìœ í˜• í¬í•¨ ì—¬ë¶€)
                threat_type = situation_info.get('ìœ„í˜‘ìœ í˜•', '')
                df_matched = df_filtered[df_filtered['ì ìš©ìœ„í˜‘'].str.contains(threat_type, na=False)]
            </div>
        </div>

        <div class="step-box">
            <h3>Step 2: ë°©ì±… ìœ í˜• ë° ìœ„í˜‘ í•„í„°ë§</h3>
            <p>ê²€ìƒ‰ëœ COA í›„ë³´ ì¤‘ ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë°©ì±…ë§Œ ìœ ì§€:</p>
            <table>
                <thead>
                    <tr>
                        <th>í•„í„° ê¸°ì¤€</th>
                        <th>ì„¤ëª…</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>ë°©ì±…ìœ í˜•</td>
                        <td><code>coa_type</code>ê³¼ ì¼ì¹˜ (Defense, Offensive, Counter_Attack ë“±)</td>
                    </tr>
                    <tr>
                        <td>ìœ„í˜‘ìœ í˜•</td>
                        <td>í˜„ì¬ ìƒí™©ì˜ ìœ„í˜‘ ìœ í˜•ì— ì í•©í•œ ë°©ì±…</td>
                    </tr>
                    <tr>
                        <td>í™œì„±í™” ìƒíƒœ</td>
                        <td>ë¹„í™œì„±í™”ë˜ì§€ ì•Šì€ ë°©ì±… (active=True)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="step-box">
            <h3>Step 3: ë‹¤ì¤‘ ê¸°ì¤€ ì ìˆ˜ ì‚°ì •</h3>
            <p><strong>ëª¨ë“œ ì„ íƒ</strong>:</p>
            <ul>
                <li><strong>Palantir Mode</strong> (ê¸°ë³¸): <code>COAScorer</code> í´ë˜ìŠ¤ ì‚¬ìš©, 7ê°œ ìš”ì†Œ ì¢…í•© í‰ê°€</li>
                <li><strong>Basic Mode</strong>: ê°„ì†Œí™”ëœ ì ìˆ˜ ê³„ì‚°</li>
            </ul>

            <h4>3-A. Palantir Mode - COAScorer (í•µì‹¬)</h4>
            <p><strong>íŒŒì¼</strong>: <code>core_pipeline/coa_scorer.py</code></p>
            <p><strong>7ê°œ í•µì‹¬ í‰ê°€ ìš”ì†Œ</strong>:</p>
            <table>
                <thead>
                    <tr>
                        <th>ìš”ì†Œ</th>
                        <th>ê°€ì¤‘ì¹˜</th>
                        <th>ì„¤ëª…</th>
                        <th>ê³„ì‚° í•¨ìˆ˜</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1. ìœ„í˜‘ ëŒ€ì‘ì„±</td>
                        <td>0.25</td>
                        <td>ìœ„í˜‘ ìœ í˜•-ë°©ì±… íš¨ê³¼ì„± ë§¤í•‘</td>
                        <td><code>_calculate_threat_score()</code></td>
                    </tr>
                    <tr>
                        <td>2. ìì› ê°€ìš©ì„±</td>
                        <td>0.20</td>
                        <td>í•„ìš” ìì› vs ë³´ìœ  ìì›</td>
                        <td><code>_calculate_resource_score()</code></td>
                    </tr>
                    <tr>
                        <td>3. ì „ë ¥ ëŠ¥ë ¥</td>
                        <td>0.15</td>
                        <td>ì•„êµ° ì „íˆ¬ë ¥ vs ìš”êµ¬ ëŠ¥ë ¥</td>
                        <td><code>_calculate_asset_score()</code></td>
                    </tr>
                    <tr>
                        <td>4. í™˜ê²½ ì í•©ì„±</td>
                        <td>0.10</td>
                        <td>ê¸°ìƒ, ì§€í˜• ì¡°ê±´ ê³ ë ¤</td>
                        <td><code>_calculate_environment_score()</code></td>
                    </tr>
                    <tr>
                        <td>5. ê³¼ê±° ì„±ê³µë¥ </td>
                        <td>0.10</td>
                        <td>ì›Œê²Œì„ ìŠ¹ë¥  ë°ì´í„°</td>
                        <td><code>_calculate_historical_score()</code></td>
                    </tr>
                    <tr>
                        <td>6. ì¶”ë¡  ì²´ì¸</td>
                        <td>0.10</td>
                        <td>ì˜¨í†¨ë¡œì§€ ì¶”ë¡  ê²½ë¡œ ì‹ ë¢°ë„</td>
                        <td><code>_calculate_chain_score()</code></td>
                    </tr>
                    <tr>
                        <td>7. ì„ë¬´ ë¶€í•©ì„±</td>
                        <td>0.10</td>
                        <td>ì„ë¬´ ìœ í˜•-ë°©ì±… ìœ í˜• ì •í•©ì„±</td>
                        <td><code>_calculate_mission_alignment_score()</code></td>
                    </tr>
                </tbody>
            </table>

            <div class="formula-box">
                <strong>ìµœì¢… ì ìˆ˜ ê³„ì‚° ê³µì‹:</strong><br />
                <code>ìµœì¢…ì ìˆ˜ = Î£ (ê°œë³„ìš”ì†Œì ìˆ˜ Ã— ê°€ì¤‘ì¹˜)</code><br /><br />
                <code>ìµœì¢…ì ìˆ˜ = 0.25Ã—ìœ„í˜‘ + 0.20Ã—ìì› + 0.15Ã—ì „ë ¥ + 0.10Ã—í™˜ê²½ + 0.10Ã—ê³¼ê±° + 0.10Ã—ì²´ì¸ + 0.10Ã—ì„ë¬´</code>
            </div>

            <h4>í•µì‹¬ ìš”ì†Œ ê³„ì‚° ìƒì„¸</h4>

            <h5>1) ìœ„í˜‘ ëŒ€ì‘ì„± ì ìˆ˜</h5>
            <p><code>ë°©ì±…ìœ í˜•_ìœ„í˜‘ìœ í˜•_ê´€ë ¨ì„±.xlsx</code> ì°¸ì¡°:</p>
            <div class="code-block">
                # ì˜ˆì‹œ: Air Assault ìœ„í˜‘ì— ëŒ€í•œ ë°©ì±…ë³„ íš¨ê³¼ì„±
                relevance_map = {
                "Air Assault": {
                "defense": 0.8, # ë°©ì–´ê°€ ì ì ˆ
                "counter_attack": 0.7, # ë°˜ê²©ë„ ê°€ëŠ¥
                "offensive": 0.3 # ê³µê²©ì€ ë¶€ì ì ˆ
                }
                }

                threat_score = relevance_map[threat_type][coa_type]
            </div>

            <h5>2) ìì› ê°€ìš©ì„± ì ìˆ˜</h5>
            <div class="code-block">
                # contextì—ì„œ resource_availability í™œìš©
                # 0.0 (ìì› ë¶€ì¡±) ~ 1.0 (ìì› ì¶©ë¶„)
                required_resources = coa.get('í•„ìš”ìì›', '')
                available_resources = situation_info.get('available_resources', {})

                # ë§¤ì¹­ë¥  ê³„ì‚°
                availability_ratio = len(available) / len(required)
                resource_score = min(1.0, availability_ratio)
            </div>

            <h5>3) ê³¼ê±° ì„±ê³µë¥  ì ìˆ˜</h5>
            <p><code>ì›Œê²Œì„_ëª¨ì˜_ë¶„ì„_ìŠ¹ë¥ .xlsx</code> ë°ì´í„° í™œìš©:</p>
            <div class="code-block">
                # COAë³„ ì˜ˆìƒ ì„±ê³µë¥  ì§ì ‘ ì‚¬ìš©
                success_rate = coa.get('ì˜ˆìƒì„±ê³µë¥ ', 0.5) # ê¸°ë³¸ê°’ 50%

                # RAG ê²€ìƒ‰ ê²°ê³¼ì—ì„œ ì¶”ê°€ ë³´ì •
                if 'rag_results' in context:
                # ê¸ì •/ë¶€ì • í‚¤ì›Œë“œ ë¹„ìœ¨ë¡œ ì¡°ì •
                historical_score = success_rate * rag_modifier
            </div>
        </div>

        <div class="step-box">
            <h3>Step 4: ì¶”ì²œ ì‚¬ìœ  ìƒì„±</h3>
            <p><strong>í•¨ìˆ˜</strong>: <code>_generate_recommendation_reason(strategy, situation_info)</code></p>
            <p><strong>ìš°ì„ ìˆœìœ„</strong>:</p>
            <ol>
                <li><strong>ì˜¨í†¨ë¡œì§€ ê¸°ë°˜</strong>: ì¶”ë¡  ê²½ë¡œì—ì„œ í•µì‹¬ ê´€ê³„ ì¶”ì¶œ</li>
                <li><strong>ì ìˆ˜ ê¸°ë°˜</strong>: ê°€ì¥ ë†’ì€ ì ìˆ˜ë¥¼ ë°›ì€ ìš”ì†Œ ê°•ì¡°</li>
                <li><strong>í´ë°±</strong>: ìœ„í˜‘ìˆ˜ì¤€ ë° ì í•©ì„± ê¸°ë³¸ ë¬¸êµ¬</li>
            </ol>
            <div class="code-block">
                # ì˜ˆì‹œ ì¶”ì²œì‚¬ìœ  ì¶œë ¥
                "ìœ„í˜‘ìˆ˜ì¤€ Highì— ì í•©í•˜ë©°, ë°©ì–´ ì „ë ¥ì´ ì¶©ë¶„í•˜ê³  ê³¼ê±° ì„±ê³µë¥  85%ë¡œ ì‹ ë¢°ì„±ì´ ë†’ìŠµë‹ˆë‹¤."
            </div>
        </div>

        <div class="step-box">
            <h3>Step 5-7: ê²°ê³¼ ë³‘í•© ë° ë‹¤ì–‘ì„± í•„í„°ë§</h3>
            <p>ëª¨ë“  ë°©ì±… ìœ í˜•ì˜ ê²°ê³¼ë¥¼ ë³‘í•© í›„ <strong>Multi-Perspective Logic</strong> ì ìš©:</p>

            <div class="info-box">
                <h4>ğŸ¯ ë‹¤ê°ì  ì „ìˆ  ê²°ì‹¬ ì§€ì› ëª¨ë¸</h4>
                <p>ë‹¨ìˆœ ì ìˆ˜ ìˆœìœ„ê°€ ì•„ë‹Œ, ì§€íœ˜ê´€ì´ ê³ ë ¤í•´ì•¼ í•  <strong>ì„œë¡œ ë‹¤ë¥¸ ì„±ê²©ì˜ ëŒ€ì•ˆ</strong>ì„ ì œì‹œí•©ë‹ˆë‹¤:</p>
                <ol>
                    <li><strong>[ìš°ì„ ìˆœìœ„ 1] ì‘ì „ ìµœì ì•ˆ</strong>
                        <ul>
                            <li>ê°€ì¥ ì ìˆ˜ê°€ ë†’ê³  ì•ˆì •ì ì¸ ë°©ì±…</li>
                            <li><code>selection_reason = "ì‘ì „ ìµœì ì•ˆ"</code></li>
                        </ul>
                    </li>
                    <li><strong>[ìš°ì„ ìˆœìœ„ 2] ì£¼ë„ê¶Œ í™•ë³´í˜•</strong>
                        <ul>
                            <li>ê³µì„¸ì /ëŠ¥ë™ì  ëŒ€ì•ˆ (Preemptive, Offensive, Counter_Attack, Maneuver)</li>
                            <li>ìˆ˜ì„¸ì  ìƒí™©ì—ì„œë„ ì£¼ë„ê¶Œì„ ì¡ê¸° ìœ„í•œ ì„ íƒì§€</li>
                            <li>ìµœì†Œ íƒ€ë‹¹ì„±: ìµœì ì•ˆ ì ìˆ˜ì˜ 40% ì´ìƒ</li>
                            <li><code>selection_reason = "ì£¼ë„ê¶Œ í™•ë³´"</code></li>
                        </ul>
                    </li>
                    <li><strong>[ìš°ì„ ìˆœìœ„ 3] ì°¨ìˆœìœ„ ìµœì /ì „ë ¥ ë³´ì¡´</strong>
                        <ul>
                            <li>ë‚¨ì€ í›„ë³´ ì¤‘ ë‹¤ìŒ ìˆœìœ„</li>
                            <li><code>selection_reason = "ì°¨ìˆœìœ„ ìµœì "</code></li>
                        </ul>
                    </li>
                </ol>
            </div>

            <div class="code-block">
                # ì½”ë“œ ì°¸ì¡°: logic_defense_enhanced.py ë¼ì¸ 429-491
                recommendations = []

                # 1. ì‘ì „ ìµœì ì•ˆ
                best_coa = all_recommendations[0]
                best_coa['selection_reason'] = "ì‘ì „ ìµœì ì•ˆ"
                recommendations.append(best_coa)

                # 2. ì£¼ë„ê¶Œ í™•ë³´í˜•
                aggressive_types = ['preemptive', 'offensive', 'counter_attack', 'maneuver']
                aggressive_candidates = [
                r for r in all_recommendations
                if r.get('coa_type') in aggressive_types
                and r.get('ìµœì¢…ì ìˆ˜', 0) >= best_coa.get('ìµœì¢…ì ìˆ˜', 0) * 0.4
                ]
                if aggressive_candidates:
                agg_choice = aggressive_candidates[0]
                agg_choice['selection_reason'] = "ì£¼ë„ê¶Œ í™•ë³´"
                recommendations.append(agg_choice)

                # 3. ì°¨ìˆœìœ„ ìµœì  (ë‚˜ë¨¸ì§€ ìƒìœ„ í›„ë³´)
                for cand in all_recommendations:
                if len(recommendations) >= top_k:
                break
                if cand['COA_ID'] not in selected_ids:
                cand['selection_reason'] = "ì°¨ìˆœìœ„ ìµœì "
                recommendations.append(cand)
            </div>
        </div>

        <h2>ğŸ“Š ë°ì´í„° íë¦„ ì¶”ì </h2>
        <table>
            <thead>
                <tr>
                    <th>ë‹¨ê³„</th>
                    <th>ì…ë ¥</th>
                    <th>ì²˜ë¦¬</th>
                    <th>ì¶œë ¥</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>situation_analysis, coa_type="defense"</td>
                    <td>SPARQL ì¿¼ë¦¬ or ì—‘ì…€ ê²€ìƒ‰</td>
                    <td>candidate_strategies (list)</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>candidate_strategies</td>
                    <td>ìœ í˜•/ìœ„í˜‘ í•„í„°ë§</td>
                    <td>filtered_strategies (list)</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>filtered_strategies, context</td>
                    <td>COAScorer.calculate_score()</td>
                    <td>scored_strategies with ìµœì¢…ì ìˆ˜</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>scored_strategies</td>
                    <td>_generate_recommendation_reason()</td>
                    <td>strategies with ì¶”ì²œì‚¬ìœ </td>
                </tr>
                <tr>
                    <td>5-7</td>
                    <td>all_recommendations (ëª¨ë“  ìœ í˜•)</td>
                    <td>ì •ë ¬ + ë‹¤ì–‘ì„± í•„í„°ë§</td>
                    <td>Top-3 recommendations</td>
                </tr>
            </tbody>
        </table>

        <h2>ğŸ“‚ ì½”ë“œ ì°¸ì¡°</h2>
        <table>
            <thead>
                <tr>
                    <th>íŒŒì¼</th>
                    <th>ì£¼ìš” í•¨ìˆ˜</th>
                    <th>ë¼ì¸</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>logic_defense_enhanced.py</td>
                    <td><code>_recommend_by_type()</code></td>
                    <td>764-829</td>
                </tr>
                <tr>
                    <td>logic_defense_enhanced.py</td>
                    <td><code>_search_strategies()</code></td>
                    <td>1951-2100</td>
                </tr>
                <tr>
                    <td>logic_defense_enhanced.py</td>
                    <td><code>_search_strategies_via_sparql()</code></td>
                    <td>1798-1950</td>
                </tr>
                <tr>
                    <td>logic_defense_enhanced.py</td>
                    <td><code>_score_strategies()</code></td>
                    <td>2200-2350</td>
                </tr>
                <tr>
                    <td>coa_scorer.py</td>
                    <td><code>COAScorer.calculate_score()</code></td>
                    <td>497-636</td>
                </tr>
                <tr>
                    <td>coa_scorer.py</td>
                    <td>7ê°œ ìš”ì†Œ ê³„ì‚° í•¨ìˆ˜</td>
                    <td>703-1256</td>
                </tr>
                <tr>
                    <td>logic_defense_enhanced.py</td>
                    <td>ë‹¤ì–‘ì„± í•„í„°ë§ ë¡œì§</td>
                    <td>429-491</td>
                </tr>
            </tbody>
        </table>

        <h2>âš™ï¸ ì„¤ì • ë° ê°€ì¤‘ì¹˜</h2>
        <div class="info-box">
            <h3>ê°€ì¤‘ì¹˜ ì»¤ìŠ¤í„°ë§ˆì´ì§•</h3>
            <p><code>data_lake/í‰ê°€ê¸°ì¤€_ê°€ì¤‘ì¹˜.xlsx</code> íŒŒì¼ì—ì„œ ìš”ì†Œë³„ ê°€ì¤‘ì¹˜ ì¡°ì • ê°€ëŠ¥:</p>
            <ul>
                <li>ë°©ì±… ìœ í˜•ë³„ë¡œ ë‹¤ë¥¸ ê°€ì¤‘ì¹˜ ì ìš© ê°€ëŠ¥ (Defense, Offensive ë“±)</li>
                <li>ìœ„í˜‘ ìœ í˜•ë³„ íš¨ê³¼ì„±ì€ <code>ë°©ì±…ìœ í˜•_ìœ„í˜‘ìœ í˜•_ê´€ë ¨ì„±.xlsx</code>ì—ì„œ ê´€ë¦¬</li>
            </ul>
        </div>

        <h2>âœ… ê²€ì¦ í¬ì¸íŠ¸</h2>
        <div class="warning-box">
            <h3>Phase 3 í’ˆì§ˆ í™•ë³´ ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
            <ol>
                <li><strong>COA ê²€ìƒ‰ ì™„ì „ì„±</strong>: SPARQL ì¿¼ë¦¬ê°€ ëª¨ë“  ê´€ë ¨ ë°©ì±…ì„ í¬í•¨í•˜ëŠ”ì§€</li>
                <li><strong>ì ìˆ˜ ê³„ì‚° ì •í™•ì„±</strong>: ê° ìš”ì†Œ ì ìˆ˜ê°€ 0-1 ë²”ìœ„ ë‚´ì¸ì§€, NaN/Inf ì—†ëŠ”ì§€</li>
                <li><strong>ê°€ì¤‘ì¹˜ í•©ê³„</strong>: ëª¨ë“  ìš”ì†Œ ê°€ì¤‘ì¹˜ í•©ì´ 1.0ì¸ì§€</li>
                <li><strong>ë‹¤ì–‘ì„± í™•ë³´</strong>: Top-3ê°€ ëª¨ë‘ ê°™ì€ ìœ í˜•ì´ ì•„ë‹Œì§€ (ë…ì  ë°©ì§€)</li>
                <li><strong>ì¶”ì²œì‚¬ìœ  ëª…í™•ì„±</strong>: ì‚¬ìœ ê°€ êµ¬ì²´ì ì´ê³  ì´í•´ ê°€ëŠ¥í•œì§€</li>
                <li><strong>ë°ì´í„° ì†ŒìŠ¤ íˆ¬ëª…ì„±</strong>: ì–´ë–¤ í…Œì´ë¸”/í•„ë“œê°€ ì ìˆ˜ ê³„ì‚°ì— ì‚¬ìš©ë˜ì—ˆëŠ”ì§€ ì¶”ì  ê°€ëŠ¥í•œì§€</li>
            </ol>
        </div>

        <h2>ğŸ”— Next Phase</h2>
        <p><strong>Phase 4: LLM-based Reasoning</strong>ìœ¼ë¡œ ì´ë™</p>
        <p>Top-N COA í›„ë³´ì— ëŒ€í•´ LLMì´ ìì—°ì–´ ì¶”ë¡ ì„ ìˆ˜í–‰í•˜ê³ , ë°©ì±…ë³„ ë¶€ëŒ€ ìš´ìš© ê·¼ê±°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
    </div>
    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</body>

</html>