# 위협유형 마스터 테이블 운용 가이드

**작성일**: 2025-12-27  
**목적**: 위협 유형 데이터의 단일 진실 공급원(Single Source of Truth) 확립

---

## 📋 마스터 테이블 구조

### 파일: `data_lake/위협유형_마스터.xlsx`

| 컬럼명 | 타입 | 필수 | 설명 | 예시 |
|--------|------|------|------|------|
| 위협유형코드 | String | O | 고유 식별자 (변경 불가) | THR_TYPE_001 |
| 위협유형명 | String | O | 실제 사용되는 위협 유형 이름 | 침투 |
| 위협카테고리 | String | O | 위협 분류 | 지상전, 공중전, 화력전 등 |
| 위협심도 | String | O | 위협 심각도 | Critical, High, Medium, Low |
| 설명 | String | O | 위협 유형 상세 설명 | 적 보병의 침투 공격 |
| 대표키워드 | String | X | 검색/매칭용 키워드 (쉼표 구분) | 침투,잠입,특수부대 |
| 사용여부 | String | O | 현재 사용 여부 (Y/N) | Y |

---

## 🎯 데이터 범위 정의

### 1. **위협상황.xlsx의 '위협유형코드' 컬럼**

#### 허용 값
```
마스터 테이블의 '위협유형명' 컬럼 값만 사용 가능
(사용여부 = 'Y'인 항목만 권장)
```

#### 현재 사용 가능한 값 (7개)
1. 침투
2. 포병준비
3. 집결징후
4. 기습공격
5. 도하
6. 공중위협
7. 기만징후

#### 향후 사용 가능한 값 (4개)
8. 사이버 (사용여부 = 'N' → 'Y'로 변경 후 사용)
9. 국지도발
10. 전면공격
11. 포격

#### 예시
```excel
위협ID | 위협명 | 위협유형코드 | ...
THR001 | 침투503 침투 | 침투 | ...
THR006 | 고지245 공중위협 | 공중위협 | ...
```

---

### 2. **방책유형_위협유형_관련성.xlsx의 'threat_type' 컬럼**

#### 허용 값
```
마스터 테이블의 '위협유형명' 컬럼 값과 동일
```

#### 예시
```excel
coa_type | threat_type | base_relevance | ...
Defense | 침투 | 0.85 | ...
Preemptive | 공중위협 | 0.85 | ...
```

---

## 🔄 운용 프로세스

### 신규 위협 유형 추가 시

```
1. 위협유형_마스터.xlsx 업데이트
   ├─ 새 행 추가
   ├─ 위협유형코드: THR_TYPE_XXX (순번 부여)
   ├─ 위협유형명: 실제 사용할 이름
   ├─ 사용여부: Y
   └─ 기타 필드 작성

2. 방책유형_위협유형_관련성.xlsx 업데이트
   └─ 7개 방책 유형별 관련성 매핑 추가
      (Defense, Offensive, CounterAttack, Maneuver, 
       Deterrence, Preemptive, InformationOps)

3. 위협상황.xlsx 사용
   └─ 위협유형코드 컬럼에 새 위협유형명 입력 가능

4. 온톨로지 재생성
   └─ 시스템 재시작 또는 온톨로지 수동 재생성
```

### 기존 위협 유형 수정 시

```
⚠️ 주의: 위협유형명 변경 시 모든 참조 데이터 업데이트 필요

1. 위협유형_마스터.xlsx에서 위협유형명 변경

2. 위협상황.xlsx 일괄 업데이트
   └─ 이전 위협유형명 → 새 위협유형명

3. 방책유형_위협유형_관련성.xlsx 일괄 업데이트
   └─ threat_type 컬럼 값 변경

4. 온톨로지 재생성
```

### 위협 유형 삭제 시

```
1. 위협유형_마스터.xlsx
   └─ 사용여부: Y → N (삭제 대신 비활성화 권장)

2. 위협상황.xlsx 확인
   └─ 해당 위협유형 사용 중인 행이 있는지 확인
   └─ 있으면 다른 위협유형으로 변경 후 비활성화

3. 방책유형_위협유형_관련성.xlsx
   └─ 해당 매핑 삭제 또는 유지 (향후 재사용 가능)
```

---

## ✅ 참조 무결성 검증

### 자동 검증 스크립트
```bash
# 매일 또는 데이터 변경 후 실행
python scripts/validate_threat_type_integrity.py
```

### 검증 항목
1. ✅ 위협상황.xlsx의 모든 위협유형코드가 마스터에 존재하는가?
2. ✅ 관련성 테이블의 모든 threat_type이 마스터에 존재하는가?
3. ✅ 마스터에서 사용여부='Y'인 항목이 실제로 사용되고 있는가?
4. ✅ 관련성 테이블에 모든 활성 위협 유형의 매핑이 존재하는가?

---

## 📊 데이터 일관성 규칙

### Rule 1: 명명 규칙
```
위협유형코드: THR_TYPE_XXX (XXX는 001부터 순번)
위협유형명: 한글 또는 영문 (공백 없이, 특수문자 최소화)
```

### Rule 2: 필수 매핑
```
사용여부='Y'인 모든 위협 유형은 반드시 7개 방책 유형과의 
관련성 매핑을 가져야 함
```

### Rule 3: 카테고리 표준
```
허용 카테고리:
- 지상전, 공중전, 해상전, 화력전
- 기동전, 전자전, 비전통전
- 징후, 국지전, 전면전
```

### Rule 4: 심도 표준
```
허용 심도: Critical, High, Medium, Low
```

---

## 🔧 자동화 도구

### 1. 마스터 테이블 생성
(수동 생성 권장) `data_lake/위협유형_마스터.xlsx` 파일을 직접 생성하거나 템플릿을 활용하세요.

### 2. 참조 무결성 검증
```bash
python scripts/validate_threat_type_integrity.py
```

### 3. 누락된 매핑 자동 추가
```bash
python scripts/add_missing_threat_mappings.py
```

### 4. 온톨로지 재생성
```bash
python scripts/enhance_ontology_from_excel.py
```

---

## 📈 마이그레이션 계획

### Phase 1: 마스터 테이블 도입 (완료 ✅)
- [x] 위협유형_마스터.xlsx 생성
- [x] 현재 사용 중인 7개 위협 유형 등록
- [x] 향후 사용 가능한 4개 위협 유형 등록

### Phase 2: 데이터 정합성 확보 (진행 중)
- [x] 누락된 위협 유형 매핑 추가 (28개 매핑)
- [ ] 위협상황.xlsx 데이터 검증
- [ ] 관련성 테이블 데이터 검증

### Phase 3: 자동화 구현 (예정)
- [ ] 온톨로지 생성 시 자동 검증
- [ ] CI/CD 파이프라인 통합
- [ ] 데이터 품질 모니터링 대시보드

---

## 🎯 기대 효과

### 즉시
- ✅ 위협 유형 데이터의 단일 진실 공급원 확립
- ✅ 참조 무결성 검증 가능
- ✅ 데이터 불일치 방지

### 중기
- ✅ 새 위협 추가 시 표준화된 프로세스
- ✅ 데이터 품질 향상
- ✅ 유지보수 용이성 증가

### 장기
- ✅ 확장 가능한 데이터 아키텍처
- ✅ 자동화된 데이터 관리
- ✅ 시스템 안정성 향상

---

## 📞 문의 및 지원

데이터 추가/수정 시 마스터 테이블 운용 가이드를 참조하시고,
불명확한 사항은 시스템 관리자에게 문의하시기 바랍니다.
