# ìœ„í˜‘ ìœ í˜• ë°ì´í„° ì•„í‚¤í…ì²˜ ë¬¸ì œ ë¶„ì„ ë° ê°œì„ ë°©í–¥

**ì‘ì„±ì¼**: 2025-12-27  
**ì´ìŠˆ**: ìœ„í˜‘ ìœ í˜• ì»¬ëŸ¼ ì¤‘ë³µ ë° ì°¸ì¡° ë¬´ê²°ì„± ë¬¸ì œ

---

## ğŸ”´ í˜„ì¬ ë¬¸ì œì 

### 1. **ë°ì´í„° ì¤‘ë³µ ë° ë¶ˆì¼ì¹˜**

#### ìœ„í˜‘ìƒí™©.xlsx
```
ì»¬ëŸ¼:
- ìœ„í˜‘ìœ í˜• (ì‚­ì œë¨) 
- ìœ„í˜‘ìœ í˜•ì½”ë“œ (í˜„ì¬ ì‚¬ìš© ì¤‘)

ë°ì´í„° ì˜ˆì‹œ:
THR001: ìœ„í˜‘ìœ í˜•ì½”ë“œ = "ì¹¨íˆ¬"
THR006: ìœ„í˜‘ìœ í˜•ì½”ë“œ = "ê³µì¤‘ìœ„í˜‘"
```

#### ë°©ì±…ìœ í˜•_ìœ„í˜‘ìœ í˜•_ê´€ë ¨ì„±.xlsx
```
ì»¬ëŸ¼:
- threat_type

ë°ì´í„° ì˜ˆì‹œ:
threat_type = ["ì¹¨íˆ¬", "í¬ê²©", "ê¸°ìŠµê³µê²©", "ì‚¬ì´ë²„", "ì „ë©´ê³µê²©", "êµ­ì§€ë„ë°œ", "ê³µì¤‘ìœ„í˜‘"]
```

### 2. **ì°¸ì¡° ë¬´ê²°ì„± ë¬¸ì œ**

```
ìœ„í˜‘ìƒí™©.xlsx (ìœ„í˜‘ìœ í˜•ì½”ë“œ)  â†â†’  ë°©ì±…ìœ í˜•_ìœ„í˜‘ìœ í˜•_ê´€ë ¨ì„±.xlsx (threat_type)
         â†“                                    â†“
    "ê³µì¤‘ìœ„í˜‘"                            "ê³µì¤‘ìœ„í˜‘" âœ… (ë°©ê¸ˆ ì¶”ê°€)
    "ì¹¨íˆ¬"                                "ì¹¨íˆ¬" âœ…
    "ì‚¬ì´ë²„"                              "ì‚¬ì´ë²„" âœ…
    
ë¬¸ì œ: ë‘ í…Œì´ë¸” ê°„ ê°’ì´ ìˆ˜ë™ìœ¼ë¡œ ê´€ë¦¬ë˜ì–´ ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„± ë†’ìŒ
```

### 3. **ì•„í‚¤í…ì²˜ ë¬¸ì œì **

1. **ë‹¨ì¼ ì§„ì‹¤ ê³µê¸‰ì›(Single Source of Truth) ë¶€ì¬**
   - ìœ„í˜‘ ìœ í˜•ì´ ì—¬ëŸ¬ ê³³ì— ì¤‘ë³µ ì •ì˜ë¨
   - ë§ˆìŠ¤í„° ë°ì´í„° í…Œì´ë¸” ì—†ìŒ

2. **ì°¸ì¡° ë¬´ê²°ì„± ê²€ì¦ ë©”ì»¤ë‹ˆì¦˜ ì—†ìŒ**
   - ìœ„í˜‘ìƒí™©.xlsxì˜ ìœ„í˜‘ìœ í˜•ì½”ë“œê°€ ê´€ë ¨ì„± í…Œì´ë¸”ì— ì¡´ì¬í•˜ëŠ”ì§€ ê²€ì¦ ì•ˆ ë¨
   - ìƒˆë¡œìš´ ìœ„í˜‘ ì¶”ê°€ ì‹œ ìˆ˜ë™ìœ¼ë¡œ ê´€ë ¨ì„± í…Œì´ë¸” ì—…ë°ì´íŠ¸ í•„ìš”

3. **ë°ì´í„° ì •ê·œí™” ë¶€ì¡±**
   - ìœ„í˜‘ ìœ í˜•ì´ ì½”ë“œ í…Œì´ë¸”ë¡œ ë¶„ë¦¬ë˜ì§€ ì•ŠìŒ
   - ì¤‘ë³µ ë°ì´í„° ì…ë ¥ ë° ì˜¤íƒ€ ê°€ëŠ¥ì„±

4. **ì˜¨í†¨ë¡œì§€ ìƒì„± ë¡œì§ì˜ ê°€ì •**
   - ì½”ë“œê°€ 'ìœ„í˜‘ìœ í˜•ì½”ë“œ' ì»¬ëŸ¼ì„ ì½ì§€ë§Œ, ì´ ê°’ì´ ê´€ë ¨ì„± í…Œì´ë¸”ê³¼ ì¼ì¹˜í•œë‹¤ê³  ê°€ì •
   - ëŸ°íƒ€ì„ì— ë¶ˆì¼ì¹˜ ë°œê²¬ ì‹œ ì²˜ë¦¬ ë¡œì§ ì—†ìŒ

---

## ğŸ¯ ê°œì„  ë°©í–¥

### ë°©ì•ˆ 1: **ë§ˆìŠ¤í„° ë°ì´í„° í…Œì´ë¸” ë„ì…** (ê¶Œì¥ â­)

#### ìƒˆ íŒŒì¼: `ìœ„í˜‘ìœ í˜•_ë§ˆìŠ¤í„°.xlsx`
```
ìœ„í˜‘ìœ í˜•ì½”ë“œ | ìœ„í˜‘ìœ í˜•ëª… | ìœ„í˜‘ì¹´í…Œê³ ë¦¬ | ì„¤ëª…
-----------|----------|------------|-----
THR_TYPE_001 | ì¹¨íˆ¬ | ì§€ìƒ | ì  ë³´ë³‘ì˜ ì¹¨íˆ¬ ê³µê²©
THR_TYPE_002 | í¬ê²© | í™”ë ¥ | ì  í¬ë³‘ì˜ í™”ë ¥ ê³µê²©
THR_TYPE_003 | ê¸°ìŠµê³µê²© | ì§€ìƒ | ì ì˜ ê¸°ìŠµ ê³µê²©
THR_TYPE_004 | ì‚¬ì´ë²„ | ë¹„ì „í†µ | ì‚¬ì´ë²„ ê³µê²©
THR_TYPE_005 | ê³µì¤‘ìœ„í˜‘ | ê³µì¤‘ | ì  í•­ê³µê¸° ìœ„í˜‘
THR_TYPE_006 | ì „ë©´ê³µê²© | ì§€ìƒ | ì ì˜ ì „ë©´ ê³µê²©
THR_TYPE_007 | êµ­ì§€ë„ë°œ | êµ­ì§€ | êµ­ì§€ì  ë„ë°œ
```

#### ë°ì´í„° ê´€ê³„
```
ìœ„í˜‘ìœ í˜•_ë§ˆìŠ¤í„°.xlsx (ë§ˆìŠ¤í„°)
    â†“ (FK: ìœ„í˜‘ìœ í˜•ì½”ë“œ)
    â”œâ”€â†’ ìœ„í˜‘ìƒí™©.xlsx (ìœ„í˜‘ìœ í˜•ì½”ë“œ)
    â””â”€â†’ ë°©ì±…ìœ í˜•_ìœ„í˜‘ìœ í˜•_ê´€ë ¨ì„±.xlsx (threat_type)
```

#### ì¥ì 
- âœ… ë‹¨ì¼ ì§„ì‹¤ ê³µê¸‰ì›
- âœ… ì°¸ì¡° ë¬´ê²°ì„± ê²€ì¦ ê°€ëŠ¥
- âœ… ìƒˆ ìœ„í˜‘ ì¶”ê°€ ì‹œ í•œ ê³³ë§Œ ìˆ˜ì •
- âœ… ìœ„í˜‘ ìœ í˜• ë©”íƒ€ë°ì´í„° ê´€ë¦¬ ìš©ì´

#### êµ¬í˜„
```python
# 1. ë§ˆìŠ¤í„° í…Œì´ë¸” ìƒì„±
master_df = pd.DataFrame({
    'ìœ„í˜‘ìœ í˜•ì½”ë“œ': ['ì¹¨íˆ¬', 'í¬ê²©', 'ê¸°ìŠµê³µê²©', 'ì‚¬ì´ë²„', 'ê³µì¤‘ìœ„í˜‘', 'ì „ë©´ê³µê²©', 'êµ­ì§€ë„ë°œ'],
    'ìœ„í˜‘ì¹´í…Œê³ ë¦¬': ['ì§€ìƒ', 'í™”ë ¥', 'ì§€ìƒ', 'ë¹„ì „í†µ', 'ê³µì¤‘', 'ì§€ìƒ', 'êµ­ì§€'],
    'ì„¤ëª…': [...]
})

# 2. ì°¸ì¡° ë¬´ê²°ì„± ê²€ì¦ í•¨ìˆ˜
def validate_threat_type_integrity():
    master = pd.read_excel('data_lake/ìœ„í˜‘ìœ í˜•_ë§ˆìŠ¤í„°.xlsx')
    threats = pd.read_excel('data_lake/ìœ„í˜‘ìƒí™©.xlsx')
    relevance = pd.read_excel('data_lake/ë°©ì±…ìœ í˜•_ìœ„í˜‘ìœ í˜•_ê´€ë ¨ì„±.xlsx')
    
    master_types = set(master['ìœ„í˜‘ìœ í˜•ì½”ë“œ'])
    threat_types = set(threats['ìœ„í˜‘ìœ í˜•ì½”ë“œ'].dropna())
    relevance_types = set(relevance['threat_type'].dropna())
    
    # ê²€ì¦
    invalid_threats = threat_types - master_types
    invalid_relevance = relevance_types - master_types
    
    if invalid_threats:
        raise ValueError(f"ìœ„í˜‘ìƒí™©ì— ë¯¸ì •ì˜ ìœ„í˜‘ ìœ í˜•: {invalid_threats}")
    if invalid_relevance:
        raise ValueError(f"ê´€ë ¨ì„± í…Œì´ë¸”ì— ë¯¸ì •ì˜ ìœ„í˜‘ ìœ í˜•: {invalid_relevance}")
```

---

### ë°©ì•ˆ 2: **ìë™ ë™ê¸°í™” ë©”ì»¤ë‹ˆì¦˜** (ë³´ì™„ì±…)

#### ì˜¨í†¨ë¡œì§€ ìƒì„± ì‹œ ìë™ ê²€ì¦ ë° ë™ê¸°í™”
```python
def sync_threat_types():
    """ìœ„í˜‘ìƒí™©.xlsxì˜ ìœ„í˜‘ìœ í˜•ì½”ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê´€ë ¨ì„± í…Œì´ë¸” ìë™ ì—…ë°ì´íŠ¸"""
    
    # 1. ìœ„í˜‘ìƒí™©ì—ì„œ ëª¨ë“  ìœ„í˜‘ ìœ í˜• ì¶”ì¶œ
    threats_df = pd.read_excel('data_lake/ìœ„í˜‘ìƒí™©.xlsx')
    unique_types = threats_df['ìœ„í˜‘ìœ í˜•ì½”ë“œ'].dropna().unique()
    
    # 2. ê´€ë ¨ì„± í…Œì´ë¸” ë¡œë“œ
    relevance_df = pd.read_excel('data_lake/ë°©ì±…ìœ í˜•_ìœ„í˜‘ìœ í˜•_ê´€ë ¨ì„±.xlsx')
    existing_types = set(relevance_df['threat_type'].unique())
    
    # 3. ëˆ„ë½ëœ ìœ„í˜‘ ìœ í˜• ì°¾ê¸°
    missing_types = set(unique_types) - existing_types
    
    # 4. ê¸°ë³¸ ê´€ë ¨ì„± ë§¤í•‘ ìë™ ìƒì„±
    if missing_types:
        new_mappings = []
        for threat_type in missing_types:
            for coa_type in ['Defense', 'Offensive', 'CounterAttack', 'Maneuver', 
                            'Deterrence', 'Preemptive', 'InformationOps']:
                new_mappings.append({
                    'coa_type': coa_type,
                    'threat_type': threat_type,
                    'base_relevance': 0.50,  # ê¸°ë³¸ê°’
                    'description': f'{coa_type} ë°©ì±…ê³¼ {threat_type} ìœ„í˜‘ (ìë™ ìƒì„±)'
                })
        
        # 5. ì¶”ê°€ ë° ì €ì¥
        new_df = pd.DataFrame(new_mappings)
        updated_df = pd.concat([relevance_df, new_df], ignore_index=True)
        updated_df.to_excel('data_lake/ë°©ì±…ìœ í˜•_ìœ„í˜‘ìœ í˜•_ê´€ë ¨ì„±.xlsx', index=False)
        
        print(f"âš ï¸ ìë™ ë™ê¸°í™”: {len(missing_types)}ê°œ ìœ„í˜‘ ìœ í˜• ì¶”ê°€ë¨")
```

---

### ë°©ì•ˆ 3: **ì»¬ëŸ¼ëª… í†µì¼** (ë‹¨ê¸° í•´ê²°ì±…)

#### í˜„ì¬ ë¶ˆì¼ì¹˜
```
ìœ„í˜‘ìƒí™©.xlsx: ìœ„í˜‘ìœ í˜•ì½”ë“œ
ë°©ì±…ìœ í˜•_ìœ„í˜‘ìœ í˜•_ê´€ë ¨ì„±.xlsx: threat_type
```

#### í†µì¼ì•ˆ
```
ëª¨ë“  í…Œì´ë¸”: ìœ„í˜‘ìœ í˜• (ë˜ëŠ” threat_type)
```

#### êµ¬í˜„
```python
# ìœ„í˜‘ìƒí™©.xlsx ìˆ˜ì •
threats_df = pd.read_excel('data_lake/ìœ„í˜‘ìƒí™©.xlsx')
threats_df.rename(columns={'ìœ„í˜‘ìœ í˜•ì½”ë“œ': 'ìœ„í˜‘ìœ í˜•'}, inplace=True)

# ê´€ë ¨ì„± í…Œì´ë¸” ìˆ˜ì •
relevance_df = pd.read_excel('data_lake/ë°©ì±…ìœ í˜•_ìœ„í˜‘ìœ í˜•_ê´€ë ¨ì„±.xlsx')
relevance_df.rename(columns={'threat_type': 'ìœ„í˜‘ìœ í˜•'}, inplace=True)

# ì½”ë“œ ìˆ˜ì •
# ontology_manager_enhanced.py ë¼ì¸ 1680
threat_type = row.get('ìœ„í˜‘ìœ í˜•') or row.get('threat_type')
```

---

## ğŸ“Š ê¶Œì¥ êµ¬í˜„ ìˆœì„œ

### Phase 1: ì¦‰ì‹œ ì¡°ì¹˜ (ë‹¨ê¸°)
1. âœ… **ê³µì¤‘ìœ„í˜‘ ë§¤í•‘ ì¶”ê°€** (ì™„ë£Œ)
2. **ì»¬ëŸ¼ëª… í†µì¼**
   - `ìœ„í˜‘ìœ í˜•ì½”ë“œ` â†’ `ìœ„í˜‘ìœ í˜•`
   - `threat_type` â†’ `ìœ„í˜‘ìœ í˜•`
3. **ì½”ë“œ ì—…ë°ì´íŠ¸**
   - ì˜¨í†¨ë¡œì§€ ìƒì„± ë¡œì§ ìˆ˜ì •
   - RelevanceMapper ìˆ˜ì •

### Phase 2: êµ¬ì¡° ê°œì„  (ì¤‘ê¸°)
1. **ìœ„í˜‘ìœ í˜•_ë§ˆìŠ¤í„°.xlsx ìƒì„±**
2. **ì°¸ì¡° ë¬´ê²°ì„± ê²€ì¦ í•¨ìˆ˜ êµ¬í˜„**
3. **ì˜¨í†¨ë¡œì§€ ìƒì„± ì‹œ ìë™ ê²€ì¦ ì¶”ê°€**

### Phase 3: ìë™í™” (ì¥ê¸°)
1. **ìë™ ë™ê¸°í™” ë©”ì»¤ë‹ˆì¦˜ êµ¬í˜„**
2. **ë°ì´í„° í’ˆì§ˆ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ**
3. **CI/CD íŒŒì´í”„ë¼ì¸ì— ê²€ì¦ ì¶”ê°€**

---

## ğŸ”§ ì¦‰ì‹œ ì ìš© ê°€ëŠ¥í•œ ì½”ë“œ

### 1. ì°¸ì¡° ë¬´ê²°ì„± ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
```python
# scripts/validate_threat_type_integrity.py
import pandas as pd
from pathlib import Path

def validate():
    threats = pd.read_excel('data_lake/ìœ„í˜‘ìƒí™©.xlsx')
    relevance = pd.read_excel('data_lake/ë°©ì±…ìœ í˜•_ìœ„í˜‘ìœ í˜•_ê´€ë ¨ì„±.xlsx')
    
    threat_types = set(threats['ìœ„í˜‘ìœ í˜•ì½”ë“œ'].dropna().unique())
    relevance_types = set(relevance['threat_type'].dropna().unique())
    
    missing_in_relevance = threat_types - relevance_types
    extra_in_relevance = relevance_types - threat_types
    
    print("=" * 80)
    print("ìœ„í˜‘ ìœ í˜• ì°¸ì¡° ë¬´ê²°ì„± ê²€ì¦")
    print("=" * 80)
    print(f"\nìœ„í˜‘ìƒí™© ìœ„í˜‘ ìœ í˜•: {sorted(threat_types)}")
    print(f"\nê´€ë ¨ì„± í…Œì´ë¸” ìœ„í˜‘ ìœ í˜•: {sorted(relevance_types)}")
    
    if missing_in_relevance:
        print(f"\nâš ï¸ ê´€ë ¨ì„± í…Œì´ë¸”ì— ëˆ„ë½: {missing_in_relevance}")
    if extra_in_relevance:
        print(f"\nâš ï¸ ê´€ë ¨ì„± í…Œì´ë¸”ì— ë¶ˆí•„ìš”: {extra_in_relevance}")
    
    if not missing_in_relevance and not extra_in_relevance:
        print("\nâœ… ì°¸ì¡° ë¬´ê²°ì„± ì •ìƒ")
    
    return missing_in_relevance, extra_in_relevance

if __name__ == "__main__":
    validate()
```

### 2. ì˜¨í†¨ë¡œì§€ ìƒì„± ì „ ìë™ ê²€ì¦
```python
# ontology_manager_enhanced.pyì— ì¶”ê°€
def generate_instances(self, data, ...):
    # ê¸°ì¡´ ì½”ë“œ ì „ì— ì¶”ê°€
    self._validate_threat_type_integrity(data)
    
    # ê¸°ì¡´ generate_instances ë¡œì§...

def _validate_threat_type_integrity(self, data):
    """ìœ„í˜‘ ìœ í˜• ì°¸ì¡° ë¬´ê²°ì„± ê²€ì¦"""
    if 'ìœ„í˜‘ìƒí™©' not in data:
        return
    
    threats_df = data['ìœ„í˜‘ìƒí™©']
    threat_types = set(threats_df['ìœ„í˜‘ìœ í˜•ì½”ë“œ'].dropna().unique())
    
    # ê´€ë ¨ì„± í…Œì´ë¸” ë¡œë“œ
    relevance_file = Path(self.data_lake_path) / "ë°©ì±…ìœ í˜•_ìœ„í˜‘ìœ í˜•_ê´€ë ¨ì„±.xlsx"
    if relevance_file.exists():
        relevance_df = pd.read_excel(relevance_file)
        relevance_types = set(relevance_df['threat_type'].dropna().unique())
        
        missing = threat_types - relevance_types
        if missing:
            safe_print(f"âš ï¸ ê²½ê³ : ê´€ë ¨ì„± í…Œì´ë¸”ì— ëˆ„ë½ëœ ìœ„í˜‘ ìœ í˜•: {missing}")
            safe_print("   â†’ ê¸°ë³¸ ê´€ë ¨ì„± ë§¤í•‘ì„ ìë™ ìƒì„±í•©ë‹ˆë‹¤.")
            self._auto_generate_missing_mappings(missing, relevance_file)

def _auto_generate_missing_mappings(self, missing_types, relevance_file):
    """ëˆ„ë½ëœ ìœ„í˜‘ ìœ í˜•ì— ëŒ€í•œ ê¸°ë³¸ ë§¤í•‘ ìë™ ìƒì„±"""
    # êµ¬í˜„...
```

---

## ğŸ“ˆ ê¸°ëŒ€ íš¨ê³¼

### ì¦‰ì‹œ
- âœ… ê³µì¤‘ìœ„í˜‘ ì •ìƒ ì‘ë™
- âœ… ë°ì´í„° ë¶ˆì¼ì¹˜ ê°ì§€

### ì¤‘ê¸°
- âœ… ìƒˆ ìœ„í˜‘ ì¶”ê°€ ì‹œ ìë™ ë™ê¸°í™”
- âœ… ë°ì´í„° í’ˆì§ˆ í–¥ìƒ
- âœ… ìœ ì§€ë³´ìˆ˜ ìš©ì´ì„± ì¦ê°€

### ì¥ê¸°
- âœ… í™•ì¥ ê°€ëŠ¥í•œ ë°ì´í„° ì•„í‚¤í…ì²˜
- âœ… ìë™í™”ëœ ë°ì´í„° ê²€ì¦
- âœ… ìš´ì˜ ì•ˆì •ì„± í–¥ìƒ

---

## ğŸ¯ ê²°ë¡ 

**í•µì‹¬ ë¬¸ì œ**: ìœ„í˜‘ ìœ í˜• ë°ì´í„°ê°€ ì—¬ëŸ¬ ê³³ì— ì¤‘ë³µ ì •ì˜ë˜ì–´ ìˆê³ , ì°¸ì¡° ë¬´ê²°ì„± ê²€ì¦ ë©”ì»¤ë‹ˆì¦˜ì´ ì—†ìŒ

**ê¶Œì¥ í•´ê²°ì±…**:
1. **ë‹¨ê¸°**: ì»¬ëŸ¼ëª… í†µì¼ + ìë™ ê²€ì¦
2. **ì¤‘ê¸°**: ë§ˆìŠ¤í„° ë°ì´í„° í…Œì´ë¸” ë„ì…
3. **ì¥ê¸°**: ìë™ ë™ê¸°í™” ë©”ì»¤ë‹ˆì¦˜

**ë‹¤ìŒ ë‹¨ê³„**: ìœ„ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ í˜„ì¬ ë¶ˆì¼ì¹˜ ìƒíƒœë¥¼ í™•ì¸í•˜ê³ , í•„ìš”í•œ ì¡°ì¹˜ë¥¼ ê²°ì •
