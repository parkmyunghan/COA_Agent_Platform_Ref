# 입력 테이블 스키마 분석 보고서

## 1. 개요

**분석 일자**: 2025-01-08  
**분석 대상**: data_lake의 18개 Excel 파일  
**분석 목적**: 스키마 일관성, 중복/상충 컬럼, 관계 무결성 검증

---

## 2. 테이블별 상세 분석

### 2.1 위협상황 (23개 컬럼)

#### 실제 컬럼 목록
```
위협ID, 위협명, 발생시각, 위협유형코드, 관련축선ID, 발생위치셀ID, 
관련_적부대ID, 위협수준, 관련임무ID, 원시보고텍스트, 좌표정보, 
고유명칭, 상급부대, 이동방향, 이동속도, 전투력, 상태, 위협유형, 
임무유형, 자원가용성, 기상, 지형, 시간
```

#### 발견된 문제점

**1. 위협유형 관련 중복**
- `위협유형코드`: FK (위협유형_마스터 참조)
- `위협유형`: 문자열 (명칭)
- **문제**: 코드와 명칭이 혼재되어 사용
- **권장 조치**: `위협유형` 제거, `위협유형코드`만 사용

**2. 전투력 관련**
- `전투력`: 숫자 타입
- 다른 테이블은 `전투력지수` 사용
- **문제**: 명명 불일치
- **권장 조치**: `전투력지수`로 통일

**3. 시간 관련 중복 가능성**
- `발생시각`: datetime
- `시간`: string
- **문제**: 의미 중복 가능성
- **권장 조치**: `시간` 컬럼 용도 확인 후 필요시 제거

**4. 환경 정보 중복**
- `기상`, `지형`: string
- 별도 테이블(기상상황, 지형셀) 존재
- **문제**: 정규화 위반 가능성
- **권장 조치**: FK 관계로 변경 또는 제거

### 2.2 아군부대현황 (16개 컬럼)

#### 실제 컬럼 목록
```
아군부대ID, 부대명, 제대, 병종, 전투력지수, 배치축선ID, 배치지형셀ID, 
가용상태, 임무역할, 좌표정보, 고유명칭, 상급부대, 이동방향, 이동속도, 
전투력, 상태
```

#### 발견된 문제점

**1. 전투력 관련 중복**
- `전투력지수`: 숫자
- `전투력`: 숫자
- **문제**: 의미 중복 가능성
- **권장 조치**: 용도 구분 명확화 또는 하나로 통일

**2. 상태 관련 중복**
- `가용상태`: string
- `상태`: string
- **문제**: 의미 중복 가능성
- **권장 조치**: 용도 구분 명확화

### 2.3 적군부대현황 (12개 컬럼)

#### 실제 컬럼 목록
```
적군부대ID, 부대명, 제대, 병종, 전투력지수, 배치축선ID, 배치지형셀ID, 
위협수준, 좌표정보, SIDC, 이동속도_kmh, 감지범위_km
```

#### 발견된 문제점

**1. 이동속도 명명 불일치**
- `이동속도_kmh`: 단위 포함
- 다른 테이블은 `이동속도` (단위 없음)
- **문제**: 명명 불일치
- **권장 조치**: 모든 테이블을 `이동속도_kmh`로 통일

### 2.4 지형셀 (9개 컬럼)

#### 실제 컬럼 목록
```
지형셀ID, 지형명, 지형유형, 기동성등급, 방어유리도, 관측유리도, 
요충지여부, 좌표정보, 설명
```

#### 발견된 문제점

**1. 스키마 문서 불일치**
- 실제: `X좌표`, `Y좌표` 없음, `좌표정보` 있음
- 스키마: `X좌표`, `Y좌표` 있음, `좌표정보` 없음
- **문제**: 스키마 문서가 실제 파일과 불일치
- **권장 조치**: schema_registry.yaml 업데이트

### 2.5 전장축선 (7개 컬럼)

#### 실제 컬럼 목록
```
축선ID, 축선명, 축선유형, 시작지형셀ID, 종단지형셀ID, 주요지형셀목록, 축선설명
```

#### 발견된 문제점

**1. 컬럼명 불일치**
- 실제: `주요지형셀목록` (string)
- 스키마: `구성지형셀목록` (list)
- **문제**: 컬럼명 및 타입 불일치
- **권장 조치**: 스키마 문서 수정 또는 실제 파일 수정

### 2.6 COA_Library (19개 컬럼)

#### 실제 컬럼 목록
```
COA_ID, 명칭, 방책유형, 설명, 적용조건, 키워드, 필요자원, 
전장환경_제약, 워게임_모의_분석_승률, 환경호환성, 환경비호환성, 
단계정보, 주노력여부, 시각화스타일, 적합위협유형, 자원우선순위, 
전장환경_최적조건, 연계방책, 적대응전술
```

#### 발견된 문제점

**1. 레거시 컬럼 존재**
- `연계방책`, `적대응전술`: 스키마에서 제거됨으로 표시
- **문제**: 실제 파일에 레거시 컬럼 존재
- **권장 조치**: 실제 파일에서 제거 또는 스키마에 추가

**2. 의미 중복 가능성**
- `적용조건` vs `키워드`: 의미 중복 가능성
- `환경호환성` vs `전장환경_최적조건`: 의미 중복 가능성
- **권장 조치**: 용도 구분 명확화

---

## 3. 테이블 간 관계 분석

### 3.1 Foreign Key 관계

#### 정상 작동하는 FK 관계
- ✅ 위협상황 → 지형셀 (발생위치셀ID)
- ✅ 위협상황 → 전장축선 (관련축선ID)
- ✅ 아군부대현황 → 지형셀 (배치지형셀ID)
- ✅ 아군부대현황 → 전장축선 (배치축선ID)
- ✅ 전장축선 → 지형셀 (시작지형셀ID, 종단지형셀ID)

#### 검증 필요 FK 관계
- ⚠️ 위협상황 → 적군부대현황 (관련_적부대ID)
- ⚠️ 위협상황 → 임무정보 (관련임무ID)
- ⚠️ 아군부대현황 → 임무정보 (할당임무ID) - 스키마에 있으나 실제 컬럼 확인 필요

### 3.2 추론 관계

#### 구현된 추론 관계
- ✅ 위협상황 → 민간인지역 (발생위치셀ID 기반)
- ✅ 적군부대현황 → 위협상황 (부대유형 기반)
- ✅ COA_Library → 위협유형_마스터 (적합위협유형 기반)

---

## 4. 우선순위별 조치 사항

### 🔴 Critical (즉시 조치)

**없음** (PK/FK 컬럼은 정상)

### 🟠 High (1주 이내)

1. **명명 불일치 해결**
   - 전투력: 모든 테이블을 `전투력지수`로 통일
   - 이동속도: 모든 테이블을 `이동속도_kmh`로 통일
   - 위협유형: `위협유형` 제거, `위협유형코드`만 사용

2. **스키마 문서 업데이트**
   - schema_registry.yaml 업데이트
   - excel_columns.json 업데이트

### 🟡 Medium (2주 이내)

1. **중복 컬럼 정리**
   - 위협상황: `위협유형` 제거
   - 아군부대현황: `전투력` vs `전투력지수` 통일
   - 아군부대현황: `가용상태` vs `상태` 의미 구분 명확화

2. **레거시 컬럼 처리**
   - COA_Library: `연계방책`, `적대응전술` 제거 또는 스키마 반영

### 🟢 Low (3주 이내)

1. **의미 중복 검토**
   - COA_Library: `적용조건` vs `키워드` 용도 구분
   - COA_Library: `환경호환성` vs `전장환경_최적조건` 용도 구분

2. **정규화 검토**
   - 위협상황: `기상`, `지형` 컬럼의 정규화 필요성 검토

---

## 5. 검증 스크립트 실행 결과

### 5.1 스키마 일관성 검증

**결과 요약:**
- 총 테이블 수: 16개
- 비교 가능한 테이블: 10개
- 일치하는 테이블: 5개
- 불일치하는 테이블: 5개

**불일치 테이블:**
1. 위협상황 (23개 vs 9개 예상)
2. 아군부대현황 (16개 vs 9개 예상)
3. 적군부대현황 (12개 vs 8개 예상)
4. 지형셀 (9개 vs 7개 예상)
5. COA_Library (19개 vs 9개 예상)

### 5.2 중복/상충 컬럼 분석

**테이블 내 중복:**
- 위협상황: `위협유형코드` vs `위협유형`
- 아군부대현황: `전투력지수` vs `전투력`, `가용상태` vs `상태`

**테이블 간 공통 컬럼 (의도된 것):**
- `좌표정보`: 4개 테이블
- `전투력`: 2개 테이블
- `이동속도`: 2개 테이블
- `상태`: 2개 테이블

**명명 불일치:**
- 전투력: `전투력지수` vs `전투력`
- 이동속도: `이동속도` vs `이동속도_kmh`
- 위협유형: `위협유형코드` vs `위협유형`

---

## 6. 다음 단계

### 즉시 실행 가능한 작업

1. ✅ **완료**: 실제 Excel 파일 컬럼 확인
2. ✅ **완료**: 중복/상충 컬럼 분석
3. **다음**: FK 참조 무결성 검증 스크립트 작성 및 실행
4. **다음**: 스키마 문서 업데이트
5. **다음**: 온톨로지 변환 검증

### 검증 스크립트 작성 우선순위

1. **scripts/validate_fk_integrity.py** - FK 참조 무결성 검증
2. **scripts/update_schema_registry.py** - 스키마 문서 자동 업데이트
3. **scripts/validate_data_integrity.py** - 데이터 무결성 검증
