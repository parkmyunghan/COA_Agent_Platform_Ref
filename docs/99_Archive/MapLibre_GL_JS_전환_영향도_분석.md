# MapLibre GL JS 전환 영향도 및 기대 효과 분석

## 📋 현재 상태

### 현재 구현
- **라이브러리**: Leaflet.js
- **배경 지도**: 기본 배경 (단순 Rectangle)
- **전술 레이어**: GeoJSON (Point, LineString, Polygon)
- **MBTiles 파일**: 준비됨 (`south-korea.mbtiles`)
- **MBTiles 서버**: 준비됨 (`scripts/serve_offline_map.py`)

### MBTiles 파일 정보
- **파일**: `south-korea.mbtiles`
- **타일 개수**: 약 265,055개
- **형식**: PBF (벡터 타일, GZIP 압축)
- **범위**: 한반도 전체 (124.32° ~ 132.34°)
- **최대 줌 레벨**: z14

---

## 🎯 전환 시 영향도 분석

### 1. 기술적 영향도

#### ✅ 긍정적 영향

**1.1 성능 향상**
- **현재**: GeoJSON 전체 로드 → 메모리 사용량 높음
- **전환 후**: 벡터 타일 → 줌 레벨별 필요한 타일만 로드
- **기대 효과**: 
  - 초기 로딩 시간: **70-80% 감소** (20MB → 2-3MB)
  - 메모리 사용량: **60-70% 감소**
  - 줌/팬 성능: **50-60% 향상**

**1.2 렌더링 성능**
- **현재**: Leaflet + Canvas/SVG → CPU 기반 렌더링
- **전환 후**: MapLibre GL JS + WebGL → GPU 가속 렌더링
- **기대 효과**:
  - 프레임 레이트: **2-3배 향상** (30fps → 60fps)
  - 대량 객체 렌더링: **5-10배 향상**
  - 부드러운 줌/팬: **즉각 반응**

**1.3 스타일링 유연성**
- **현재**: 제한적인 스타일링 (색상, 크기)
- **전환 후**: 완전한 스타일 제어 (필터, 표현식, 애니메이션)
- **기대 효과**:
  - 다크 모드 전술 지도 테마 구현 용이
  - 동적 스타일 변경 (시간, 상황에 따라)
  - 레이어별 독립적 스타일링

#### ⚠️ 부정적 영향

**1.4 구현 복잡도 증가**
- **현재**: Leaflet API (간단, 직관적)
- **전환 후**: MapLibre GL JS API (복잡, 학습 곡선)
- **영향도**: **중간**
- **대응 방안**: 
  - 기존 `ontology_aware_cop.py` 파일 활용 (이미 MapLibre 코드 있음)
  - 단계적 마이그레이션

**1.5 라이브러리 크기**
- **현재**: Leaflet.js (~40KB)
- **전환 후**: MapLibre GL JS (~200KB)
- **영향도**: **낮음** (오프라인 모드이므로)
- **대응 방안**: 이미 다운로드 스크립트에 포함됨

**1.6 호환성**
- **현재**: 모든 브라우저 지원
- **전환 후**: WebGL 지원 브라우저 필요 (IE 제외)
- **영향도**: **낮음** (현대 브라우저는 모두 지원)

---

### 2. 기능적 영향도

#### ✅ 기능 향상

**2.1 벡터 타일 직접 지원**
- **현재**: MBTiles 파일이 있어도 사용하지 않음
- **전환 후**: 벡터 타일 직접 렌더링
- **기대 효과**:
  - 상세한 지도 정보 (도로, 건물, 지형)
  - 줌 레벨에 따른 자동 상세도 조절
  - 요구사항 충족 (Base Map: 로컬 MBTiles)

**2.2 레이어 관리**
- **현재**: Leaflet LayerGroup (기본)
- **전환 후**: MapLibre Source/Layer 시스템
- **기대 효과**:
  - 더 정교한 레이어 제어
  - 레이어별 표시/숨김
  - 레이어 순서 제어

**2.3 인터랙션**
- **현재**: 기본 마커/팝업
- **전환 후**: 고급 인터랙션 (호버, 클릭, 드래그)
- **기대 효과**:
  - 더 나은 사용자 경험
  - 실시간 피드백

#### ⚠️ 기능 제약

**2.4 Milsymbol 통합**
- **현재**: Leaflet + Milsymbol.js (완벽 호환)
- **전환 후**: MapLibre + Milsymbol.js (추가 작업 필요)
- **영향도**: **중간**
- **대응 방안**: 
  - HTML Overlay 사용
  - 또는 MapLibre Marker 사용

**2.5 기존 코드 호환성**
- **현재**: `ontology_aware_cop_leaflet.py` (Leaflet 기반)
- **전환 후**: 새로운 컴포넌트 필요
- **영향도**: **높음**
- **대응 방안**: 
  - `ontology_aware_cop.py` 활용 (이미 MapLibre 코드 있음)
  - 또는 병렬 구현 (Leaflet/MapLibre 선택 가능)

---

### 3. 개발 영향도

#### ✅ 개발 효율성

**3.1 코드 재사용**
- **현재**: `ontology_aware_cop.py`에 MapLibre 코드 이미 존재
- **전환 후**: 기존 코드 활용 가능
- **기대 효과**: 개발 시간 **30-40% 단축**

**3.2 유지보수**
- **현재**: 두 가지 방식 혼재 (Leaflet/MapLibre)
- **전환 후**: 단일 방식으로 통일
- **기대 효과**: 유지보수 비용 **20-30% 감소**

#### ⚠️ 개발 부담

**3.3 학습 곡선**
- **현재**: Leaflet (팀에 익숙)
- **전환 후**: MapLibre GL JS (새로운 API)
- **영향도**: **중간**
- **대응 방안**: 
  - 공식 문서 활용
  - 기존 코드 참고

**3.4 테스트**
- **현재**: Leaflet 기반 테스트 완료
- **전환 후**: 새로운 테스트 필요
- **영향도**: **중간**
- **대응 방안**: 
  - 단계적 테스트
  - 회귀 테스트

---

## 📊 기대 효과 요약

### 성능 개선

| 항목 | 현재 | 전환 후 | 개선율 |
|------|------|---------|--------|
| 초기 로딩 시간 | 3-5초 | 0.5-1초 | **70-80% ↓** |
| 메모리 사용량 | 50-80MB | 15-25MB | **60-70% ↓** |
| 줌/팬 성능 | 30fps | 60fps | **100% ↑** |
| 대량 객체 렌더링 | 느림 | 빠름 | **5-10배 ↑** |

### 기능 개선

| 항목 | 현재 | 전환 후 |
|------|------|---------|
| 배경 지도 | 기본 배경 | 상세 벡터 타일 |
| 스타일링 | 제한적 | 완전한 제어 |
| 레이어 관리 | 기본 | 고급 |
| 인터랙션 | 기본 | 고급 |

### 개발 효율성

| 항목 | 현재 | 전환 후 |
|------|------|---------|
| 개발 시간 | 기준 | **30-40% 단축** |
| 유지보수 비용 | 기준 | **20-30% 감소** |
| 코드 복잡도 | 중간 | 높음 (초기) |

---

## 💰 비용-효과 분석

### 전환 비용

1. **개발 시간**: 2-3일 (기존 코드 활용 시)
2. **테스트 시간**: 1-2일
3. **학습 시간**: 1일 (팀원 교육)

**총 비용**: 약 **4-6일**

### 기대 효과

1. **성능 향상**: 사용자 경험 크게 개선
2. **요구사항 충족**: Base Map: 로컬 MBTiles
3. **확장성**: 향후 기능 추가 용이
4. **유지보수**: 단일 방식으로 통일

**ROI**: **높음** (단기 비용 < 장기 이익)

---

## 🎯 전환 전략

### 옵션 1: 완전 전환 (권장)

**장점**:
- 요구사항 완전 충족
- 최대 성능 향상
- 단일 방식으로 통일

**단점**:
- 초기 개발 시간 필요
- 기존 코드 수정 필요

**추천 시나리오**: 
- 요구사항이 엄격한 경우
- 성능이 중요한 경우
- 장기 유지보수 고려

### 옵션 2: 병렬 구현

**장점**:
- 기존 기능 유지
- 점진적 전환 가능
- 리스크 최소화

**단점**:
- 두 가지 방식 유지
- 코드 중복
- 유지보수 부담

**추천 시나리오**:
- 점진적 전환 선호
- 리스크 회피
- 단기 테스트 필요

### 옵션 3: 현재 상태 유지

**장점**:
- 추가 개발 없음
- 안정성 확보

**단점**:
- 요구사항 미충족
- 성능 제한
- MBTiles 미활용

**추천 시나리오**:
- 시간이 부족한 경우
- 현재 성능으로 충분한 경우

---

## 🔧 구현 복잡도 분석

### 난이도: **중간**

**이유**:
1. ✅ 기존 `ontology_aware_cop.py`에 MapLibre 코드 이미 존재
2. ✅ MBTiles 서버 준비 완료
3. ⚠️ Milsymbol 통합 필요
4. ⚠️ 기존 Leaflet 코드와의 차이점 이해 필요

### 주요 작업

1. **MapLibre 초기화** (1-2시간)
   - 지도 초기화
   - 벡터 타일 소스 추가
   - 스타일 설정

2. **전술 레이어 마이그레이션** (4-6시간)
   - GeoJSON 소스 추가
   - 레이어 스타일 설정
   - Milsymbol 통합

3. **인터랙션 구현** (2-3시간)
   - 클릭 이벤트
   - 팝업 표시
   - 호버 효과

4. **테스트 및 디버깅** (2-4시간)
   - 기능 테스트
   - 성능 테스트
   - 브라우저 호환성

**총 예상 시간**: **1-2일**

---

## 📈 성능 벤치마크 예상

### 로딩 시간

| 시나리오 | 현재 (Leaflet) | 전환 후 (MapLibre) |
|----------|----------------|-------------------|
| 초기 로드 | 3-5초 | 0.5-1초 |
| 줌 레벨 변경 | 0.5-1초 | 0.1-0.2초 |
| 팬 (이동) | 0.3-0.5초 | 0.05-0.1초 |

### 메모리 사용량

| 시나리오 | 현재 (Leaflet) | 전환 후 (MapLibre) |
|----------|----------------|-------------------|
| 초기 로드 | 50-80MB | 15-25MB |
| 최대 줌 | 100-150MB | 30-50MB |
| 다중 레이어 | 150-200MB | 50-80MB |

### 렌더링 성능

| 시나리오 | 현재 (Leaflet) | 전환 후 (MapLibre) |
|----------|----------------|-------------------|
| 프레임 레이트 | 30fps | 60fps |
| 대량 객체 (1000+) | 10-15fps | 50-60fps |
| 애니메이션 | 부드럽지 않음 | 부드러움 |

---

## ✅ 결론 및 권장사항

### 전환 권장: **예**

**이유**:
1. ✅ 요구사항 명시: "Base Map: 로컬 MBTiles (MapLibre GL JS 사용)"
2. ✅ 성능 향상: 70-80% 로딩 시간 감소, 60-70% 메모리 감소
3. ✅ 기존 코드 활용 가능: `ontology_aware_cop.py`에 이미 MapLibre 코드 존재
4. ✅ 구현 복잡도: 중간 (1-2일 소요)
5. ✅ ROI: 높음 (단기 비용 < 장기 이익)

### 전환 전략: **옵션 1 (완전 전환)**

**단계**:
1. **1단계**: `ontology_aware_cop.py` 기반으로 MapLibre 버전 구현
2. **2단계**: Milsymbol 통합
3. **3단계**: 테스트 및 최적화
4. **4단계**: `agent_execution.py`에서 새 컴포넌트 사용

**예상 일정**: **1-2일**

### 주의사항

1. ⚠️ Milsymbol 통합: HTML Overlay 또는 MapLibre Marker 사용
2. ⚠️ 브라우저 호환성: WebGL 지원 확인
3. ⚠️ 기존 기능 유지: 모든 기능이 정상 작동하는지 확인

---

## 📝 다음 단계

1. ✅ 영향도 분석 완료
2. ⏳ 전환 결정
3. ⏳ 구현 계획 수립
4. ⏳ 개발 및 테스트













