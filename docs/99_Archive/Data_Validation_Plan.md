# 데이터 검증 및 온톨로지 구축 프로세스 검증 계획서

> **최종 업데이트**: 2025-01-XX  
> **통합 검토**: `docs/40_Refactoring/cop_visualization_design.md`와 통합 검토 완료  
> **주요 변경사항**: 필드명 통일 결정 사항 반영, 시각화 요구사항과의 일관성 확보

## 1. 개요

### 1.1 목적
- data_lake의 입력 데이터부터 최종 방책 추천까지의 전체 프로세스 검증
- 입력 테이블 스키마 및 관계의 정확성 확인
- 중복/상충/불필요한 컬럼 식별 및 정리
- 단계별 검증을 통한 문제점 조기 발견
- **COP 시각화 요구사항과의 데이터 구조 일관성 확보** (신규)

### 1.2 검증 범위
1. **입력 데이터 검증** (Phase 1)
2. **온톨로지 변환 검증** (Phase 2)
3. **추론 엔진 검증** (Phase 3)
4. **COA 추천 검증** (Phase 4)

---

## 2. Phase 1: 입력 데이터 검증

### 2.1 테이블 목록 및 분류

#### 2.1.1 핵심 엔티티 테이블 (Core Entities)
- **아군부대현황** (18개 컬럼)
- **적군부대현황** (11개 컬럼)
- **지형셀** (7개 컬럼)
- **전장축선** (7개 컬럼)

#### 2.1.2 작전 정보 테이블 (Operational Info)
- **임무정보** (11개 컬럼)
- **위협상황** (23개 컬럼)
- **제약조건** (6개 컬럼)

#### 2.1.3 방책 및 평가 테이블 (COA & Evaluation)
- **COA_Library** (15개 컬럼)
- **방책유형_위협유형_관련성** (4개 컬럼)
- **평가기준_가중치** (4개 컬럼)

#### 2.1.4 마스터 데이터 테이블 (Master Data)
- **위협유형_마스터** (7개 컬럼)
- **시나리오모음** (8개 컬럼)

#### 2.1.5 자원 및 환경 테이블 (Resource & Environment)
- **아군가용자산** (11개 컬럼)
- **기상상황** (5개 컬럼)
- **민간인지역** (8개 컬럼)
- **가용자원** (7개 컬럼) - 레거시

**총 18개 테이블**

---

### 2.2 스키마 일관성 검증

#### 2.2.1 검증 항목

**A. 컬럼명 일관성**
- [ ] schema_registry.yaml의 컬럼명과 실제 Excel 컬럼명 일치 여부
- [ ] excel_columns.json의 컬럼명과 실제 Excel 컬럼명 일치 여부
- [ ] 대소문자, 공백, 특수문자 일관성

**B. 데이터 타입 일관성**
- [ ] schema_registry.yaml의 타입 정의와 실제 데이터 타입 일치 여부
- [ ] 숫자 컬럼의 숫자 형식 일관성 (정수/실수)
- [ ] 날짜/시간 컬럼의 형식 일관성

**C. 필수 컬럼 존재 여부**
- [ ] Primary Key (PK) 컬럼 존재 및 고유성
- [ ] Foreign Key (FK) 컬럼 존재 및 참조 무결성
- [ ] Label 컬럼 존재 (표시용)

#### 2.2.2 중복/상충 컬럼 검증

**검증 대상 테이블별 분석:**

##### 위협상황 (23개 컬럼) - **우선 검증 필요**
```
의심되는 중복/상충:
1. "위협유형코드" vs "위협유형" - 코드와 명칭 혼재
   ✅ 결정: 위협유형코드만 사용, 위협유형 제거
2. "전투력지수" vs "전투력" - 명칭 중복
   ✅ 결정: 전투력지수로 통일, 전투력 제거
3. "이동방향", "이동속도", "전투력", "상태" - 적군부대현황과 중복 가능성
   ✅ 결정: 이동속도 → 이동속도_kmh로 통일, 전투력 제거
4. "위협수준" - 문자열 vs 숫자 타입 불일치 가능성
   ⚠️ 확인 필요: 실제 데이터 타입 확인 후 숫자로 통일 권장
5. "시간" vs "발생시각" - 중복 가능성
   ✅ 결정: 발생시각만 사용, 시간 제거 검토
```

##### 아군부대현황 (18개 컬럼)
```
의심되는 중복/상충:
1. "전투력지수" vs "전투력" - 명칭 중복
   ✅ 결정: 전투력지수로 통일, 전투력 제거
2. "이동방향", "이동속도", "전투력", "상태" - 위협상황과 중복
   ✅ 결정: 이동속도 → 이동속도_kmh로 통일, 전투력 제거
3. "배치축선ID" vs "배치지형셀ID" - 위치 정보 중복 표현
   ✅ 결정: 둘 다 유지 (위치 정보 다중 표현, 시각화에서 모두 활용)
   - 배치축선ID: 축선 기반 위치 (기동로 정보)
   - 배치지형셀ID: 지형셀 기반 위치 (정확한 좌표)
```

##### 적군부대현황 (11개 컬럼)
```
의심되는 중복/상충:
1. "전투력지수" - 아군부대현황과 동일 컬럼명
   ✅ 결정: 유지 (일관성 유지, 시각화에서도 동일 필드명 사용)
2. "배치축선ID" vs "배치지형셀ID" - 위치 정보 중복 표현
   ✅ 결정: 둘 다 유지 (위치 정보 다중 표현, 시각화에서 모두 활용)
3. "이동속도_kmh" - 다른 테이블은 "이동속도" (단위 표기 불일치)
   ✅ 결정: 다른 테이블도 이동속도_kmh로 통일 (적군부대현황이 표준)
```

##### 지형셀 (7개 컬럼)
```
의심되는 중복/상충:
1. "X좌표", "Y좌표" vs "좌표정보" (다른 테이블) - 좌표 표현 방식 불일치
   ✅ 결정: 둘 다 유지, 우선순위는 좌표정보 → X좌표/Y좌표
   - 좌표정보: 직접 좌표 (더 정확, GeoJSON 표준)
   - X좌표, Y좌표: 지형셀 중심 좌표 (fallback)
2. schema_registry.yaml에는 "기동성등급", "방어유리도", "관측유리도", "요충지여부" 있으나
   excel_columns.json에는 없음 - 실제 컬럼 확인 필요
   ✅ 결정: 실제 파일에 존재하므로 schema_registry.yaml에 반영 필요
```

##### 전장축선 (7개 컬럼)
```
의심되는 중복/상충:
1. "구성지형셀목록" vs "주요지형셀목록" (excel_columns.json) - 명칭 불일치
   ✅ 결정: 주요지형셀목록으로 통일 (실제 파일 기준)
2. schema_registry.yaml에는 "구성지형셀목록" (list 타입)
   excel_columns.json에는 "주요지형셀목록" (string 타입) - 타입 불일치
   ✅ 결정: string 타입으로 통일 (콤마 구분 문자열)
   - schema_registry.yaml: 구성지형셀목록 → 주요지형셀목록으로 변경
   - 타입: list → string으로 변경
   - 시각화 로직: 콤마로 split하여 처리
```

##### COA_Library (15개 컬럼)
```
의심되는 중복/상충:
1. "적용조건" vs "전장환경_제약" - 의미 중복 가능성
2. "환경호환성" vs "전장환경_최적조건" - 의미 중복 가능성
3. "키워드" vs "적용조건" - 의미 중복 가능성
```

#### 2.2.3 검증 스크립트 작성 계획

**스크립트 1: 스키마 일관성 검증**
```python
# scripts/validate_schema_consistency.py
- schema_registry.yaml vs 실제 Excel 컬럼 비교
- excel_columns.json vs 실제 Excel 컬럼 비교
- 타입 불일치 검출
- 누락된 컬럼 검출
```

**스크립트 2: 중복/상충 컬럼 분석**
```python
# scripts/analyze_duplicate_columns.py
- 동일 의미의 다른 컬럼명 식별
- 타입 불일치 컬럼 식별
- 불필요한 컬럼 후보 식별
```

**스크립트 3: 데이터 무결성 검증**
```python
# scripts/validate_data_integrity.py
- PK 고유성 검증
- FK 참조 무결성 검증
- 필수 컬럼 NULL 검증
- 데이터 범위 검증
```

---

### 2.3 관계 무결성 검증

#### 2.3.1 Foreign Key 관계 검증

**검증 대상 관계:**

1. **위협상황 → 지형셀**
   - `발생위치셀ID` → `지형셀.지형셀ID`
   - [ ] 모든 발생위치셀ID가 지형셀 테이블에 존재하는지

2. **위협상황 → 전장축선**
   - `관련축선ID` → `전장축선.축선ID`
   - [ ] 모든 관련축선ID가 전장축선 테이블에 존재하는지

3. **위협상황 → 적군부대현황**
   - `관련_적부대ID` → `적군부대현황.적군부대ID`
   - [ ] 모든 관련_적부대ID가 적군부대현황 테이블에 존재하는지

4. **위협상황 → 임무정보**
   - `관련임무ID` → `임무정보.임무ID`
   - [ ] 모든 관련임무ID가 임무정보 테이블에 존재하는지

5. **아군부대현황 → 지형셀**
   - `배치지형셀ID` → `지형셀.지형셀ID`
   - [ ] 모든 배치지형셀ID가 지형셀 테이블에 존재하는지

6. **아군부대현황 → 전장축선**
   - `배치축선ID` → `전장축선.축선ID`
   - [ ] 모든 배치축선ID가 전장축선 테이블에 존재하는지

7. **임무정보 → 전장축선**
   - `주공축선ID`, `조공축선ID`, `예비축선ID` → `전장축선.축선ID`
   - [ ] 모든 축선ID가 전장축선 테이블에 존재하는지

8. **전장축선 → 지형셀**
   - `시작지형셀ID`, `종단지형셀ID` → `지형셀.지형셀ID`
   - [ ] 모든 지형셀ID가 지형셀 테이블에 존재하는지

#### 2.3.2 추론 관계 검증

**검증 대상:**

1. **위협상황 → 민간인지역** (추론)
   - `발생위치셀ID` 기반 동일 지형셀 추론
   - [ ] 추론 규칙이 올바르게 작동하는지

2. **적군부대현황 → 위협상황** (추론)
   - `부대유형` 기반 관련성 추론
   - [ ] 추론 규칙이 올바르게 작동하는지

3. **COA_Library → 위협유형_마스터** (추론)
   - `적합위협유형` 컬럼 기반 추론
   - [ ] 추론 규칙이 올바르게 작동하는지

#### 2.3.3 검증 스크립트 작성 계획

**스크립트 4: FK 참조 무결성 검증**
```python
# scripts/validate_fk_integrity.py
- 모든 FK 관계의 참조 무결성 검증
- 고아 레코드(Orphan Records) 검출
- 누락된 참조 대상 검출
```

**스크립트 5: 관계 매핑 검증**
```python
# scripts/validate_relation_mappings.py
- relation_mappings.json의 관계 정의 검증
- 실제 데이터에서 관계 존재 여부 확인
- 추론 관계의 confidence 값 검증
```

---

## 3. Phase 2: 온톨로지 변환 검증

### 3.1 변환 프로세스 검증

#### 3.1.1 Excel → RDF 변환 검증

**검증 항목:**

1. **엔티티 변환**
   - [ ] 모든 테이블이 올바른 클래스로 변환되는지
   - [ ] PK 컬럼이 URI로 올바르게 변환되는지
   - [ ] Label 컬럼이 rdfs:label로 올바르게 변환되는지

2. **속성 변환**
   - [ ] 모든 컬럼이 올바른 속성으로 변환되는지
   - [ ] 데이터 타입이 올바르게 변환되는지 (string, number, datetime)
   - [ ] 리스트 타입 컬럼이 올바르게 변환되는지

3. **관계 변환**
   - [ ] FK 관계가 올바른 객체 속성으로 변환되는지
   - [ ] 추론 관계가 올바르게 생성되는지
   - [ ] 관계의 방향이 올바른지

#### 3.1.2 온톨로지 스키마 검증

**검증 항목:**

1. **클래스 정의**
   - [ ] 모든 엔티티 클래스가 정의되어 있는지
   - [ ] 클래스 계층 구조가 올바른지

2. **속성 정의**
   - [ ] 모든 데이터 속성이 정의되어 있는지
   - [ ] 속성의 도메인/레인지가 올바른지

3. **관계 정의**
   - [ ] 모든 객체 속성이 정의되어 있는지
   - [ ] 관계의 도메인/레인지가 올바른지

#### 3.1.3 검증 스크립트 작성 계획

**스크립트 6: 온톨로지 변환 검증**
```python
# scripts/validate_ontology_conversion.py
- Excel 데이터와 온톨로지 인스턴스 비교
- 변환 누락 검출
- 변환 오류 검출
```

**스크립트 7: 온톨로지 스키마 검증**
```python
# scripts/validate_ontology_schema.py
- schema.ttl의 스키마 정의 검증
- instances.ttl의 인스턴스 검증
- 스키마-인스턴스 일치성 검증
```

---

## 4. Phase 3: 추론 엔진 검증

### 4.1 추론 규칙 검증

#### 4.1.1 규칙 기반 추론 검증

**검증 대상:**

1. **위협상황 → 민간인지역 추론**
   - [ ] 동일 지형셀 기반 추론이 올바르게 작동하는지
   - [ ] confidence 값이 올바르게 계산되는지

2. **적군부대현황 → 위협상황 추론**
   - [ ] 부대유형 기반 추론이 올바르게 작동하는지
   - [ ] confidence 값이 올바르게 계산되는지

3. **COA_Library → 위협유형 추론**
   - [ ] 적합위협유형 기반 추론이 올바르게 작동하는지
   - [ ] confidence 값이 올바르게 계산되는지

#### 4.1.2 SPARQL 쿼리 검증

**검증 항목:**

1. **기본 쿼리**
   - [ ] 위협상황 조회 쿼리가 올바르게 작동하는지
   - [ ] COA 조회 쿼리가 올바르게 작동하는지

2. **관계 탐색 쿼리**
   - [ ] 위협상황 → 지형셀 관계 탐색이 올바른지
   - [ ] 위협상황 → 축선 관계 탐색이 올바른지
   - [ ] COA → 위협유형 관계 탐색이 올바른지

3. **추론 기반 쿼리**
   - [ ] 추론 관계를 포함한 쿼리가 올바르게 작동하는지
   - [ ] confidence 값 필터링이 올바르게 작동하는지

#### 4.1.3 검증 스크립트 작성 계획

**스크립트 8: 추론 규칙 검증**
```python
# scripts/validate_reasoning_rules.py
- 추론 규칙 실행 및 결과 검증
- 예상 결과와 실제 결과 비교
- confidence 값 검증
```

**스크립트 9: SPARQL 쿼리 검증**
```python
# scripts/validate_sparql_queries.py
- 주요 SPARQL 쿼리 실행 및 결과 검증
- 쿼리 성능 측정
- 결과 정확성 검증
```

---

## 5. Phase 4: COA 추천 검증

### 5.1 COA 검색 및 필터링 검증

#### 5.1.1 위협 기반 COA 검색

**검증 항목:**

1. **위협유형 매칭**
   - [ ] 위협유형코드가 올바르게 매칭되는지
   - [ ] 방책유형_위협유형_관련성 테이블이 올바르게 사용되는지

2. **적용조건 매칭**
   - [ ] COA의 적용조건이 올바르게 평가되는지
   - [ ] 키워드 매칭이 올바르게 작동하는지

3. **환경 제약 검증**
   - [ ] 전장환경_제약이 올바르게 평가되는지
   - [ ] 환경호환성이 올바르게 평가되는지

#### 5.1.2 COA 점수 계산 검증

**검증 항목:**

1. **평가 요소별 점수**
   - [ ] 평가기준_가중치가 올바르게 적용되는지
   - [ ] 각 평가 요소의 점수 계산이 올바른지

2. **종합 점수**
   - [ ] 가중치 합산이 올바른지
   - [ ] 점수 정규화가 올바른지

3. **순위 결정**
   - [ ] 점수 기반 순위가 올바른지
   - [ ] 동점 처리 로직이 올바른지

#### 5.1.3 검증 스크립트 작성 계획

**스크립트 10: COA 검색 검증**
```python
# scripts/validate_coa_search.py
- 위협 기반 COA 검색 결과 검증
- 필터링 로직 검증
- 매칭 정확도 검증
```

**스크립트 11: COA 점수 계산 검증**
```python
# scripts/validate_coa_scoring.py
- 평가 요소별 점수 계산 검증
- 종합 점수 계산 검증
- 순위 결정 로직 검증
```

---

## 6. 검증 실행 계획

### 6.1 단계별 실행 순서

#### Step 1: 입력 데이터 검증 (1주차)
1. **Day 1-2**: 스키마 일관성 검증
   - 스크립트 1, 2 실행
   - 중복/상충 컬럼 식별 및 정리
   - 스키마 문서 업데이트

2. **Day 3-4**: 데이터 무결성 검증
   - 스크립트 3 실행
   - PK/FK 무결성 검증
   - 데이터 정제

3. **Day 5**: 관계 무결성 검증
   - 스크립트 4, 5 실행
   - FK 참조 무결성 검증
   - 관계 매핑 검증

#### Step 2: 온톨로지 변환 검증 (2주차)
1. **Day 1-2**: 변환 프로세스 검증
   - 스크립트 6 실행
   - Excel → RDF 변환 검증
   - 변환 오류 수정

2. **Day 3-4**: 온톨로지 스키마 검증
   - 스크립트 7 실행
   - 스키마-인스턴스 일치성 검증
   - 스키마 수정

#### Step 3: 추론 엔진 검증 (3주차)
1. **Day 1-2**: 추론 규칙 검증
   - 스크립트 8 실행
   - 추론 규칙 검증 및 수정

2. **Day 3-4**: SPARQL 쿼리 검증
   - 스크립트 9 실행
   - 쿼리 성능 및 정확성 검증

#### Step 4: COA 추천 검증 (4주차)
1. **Day 1-2**: COA 검색 검증
   - 스크립트 10 실행
   - 검색 로직 검증 및 수정

2. **Day 3-4**: COA 점수 계산 검증
   - 스크립트 11 실행
   - 점수 계산 로직 검증 및 수정

3. **Day 5**: 통합 테스트
   - 전체 프로세스 통합 테스트
   - 최종 검증 보고서 작성

---

## 7. 검증 결과 문서화

### 7.1 검증 보고서 템플릿

각 Phase별로 다음 항목을 포함한 보고서 작성:

1. **검증 범위**
2. **검증 방법**
3. **발견된 문제점**
4. **수정 사항**
5. **검증 결과 요약**

### 7.2 문제점 추적

- 이슈 트래커 또는 Excel로 문제점 추적
- 우선순위별 분류 (Critical, High, Medium, Low)
- 수정 완료 여부 추적

---

## 8. 실제 분석 결과 (2025-01-08)

### 8.0 COP 시각화 설계안과의 통합 검토 (2025-01-XX)

**통합 검토 목적**: `docs/40_Refactoring/cop_visualization_design.md`의 시각화 요구사항과 데이터 검증 계획의 일관성 확보

**통합 검토 결과**:
- ✅ 필드명 통일 사항 일치: 전투력지수, 이동속도_kmh, 위협유형코드
- ✅ 좌표 정보 우선순위 일치: 좌표정보 → 지형셀 → 축선
- ✅ 축선 컬럼명 결정: 주요지형셀목록 (실제 파일 기준)
- ✅ 시각화 데이터 구조 확장 계획 수립 완료

**최종 결정 사항 요약**:
1. **전투력**: 모든 테이블 `전투력지수`로 통일
2. **이동속도**: 모든 테이블 `이동속도_kmh`로 통일
3. **위협유형**: `위협유형코드`만 사용, `위협유형` 제거
4. **좌표 정보**: `좌표정보` 우선, `X좌표`/`Y좌표`는 fallback
5. **축선 목록**: `주요지형셀목록`으로 통일 (string 타입)

**참고 문서**: `docs/40_Refactoring/cop_visualization_design.md`

**통합 검토 목적**: `docs/40_Refactoring/cop_visualization_design.md`의 시각화 요구사항과 데이터 검증 계획의 일관성 확보

**통합 검토 결과**:
- ✅ 필드명 통일 사항 일치: 전투력지수, 이동속도_kmh, 위협유형코드
- ✅ 좌표 정보 우선순위 일치: 좌표정보 → 지형셀 → 축선
- ✅ 축선 컬럼명 결정: 주요지형셀목록 (실제 파일 기준)
- ✅ 시각화 데이터 구조 확장 계획 수립 완료

**참고 문서**: `docs/40_Refactoring/cop_visualization_design.md`

### 8.1 발견된 주요 문제점

#### 🔴 Critical Issues
- 현재 Critical 이슈는 발견되지 않음 (PK/FK 컬럼은 정상)

#### 🟠 High Priority Issues

**1. 명명 불일치 (Naming Inconsistency)**

**전투력 관련:**
- `전투력지수`: 아군부대현황, 적군부대현황
- `전투력`: 위협상황, 아군부대현황
- **문제**: 동일한 의미인데 컬럼명이 다름
- **영향**: 데이터 집계 및 분석 시 혼동 가능

**이동속도 관련:**
- `이동속도`: 위협상황, 아군부대현황
- `이동속도_kmh`: 적군부대현황
- **문제**: 단위 표기 방식 불일치
- **영향**: 단위 변환 로직 필요

**위협유형 관련:**
- `위협유형코드`: 위협상황 (FK)
- `위협유형`: 위협상황 (문자열)
- **문제**: 코드와 명칭이 혼재
- **영향**: 위협유형_마스터와의 관계 불명확

#### 🟡 Medium Priority Issues

**1. 스키마 문서 불일치**

**지형셀:**
- 실제: 9개 컬럼 (요충지여부, 관측유리도, 설명, 방어유리도, 기동성등급, 좌표정보 포함)
- 스키마: 6개 컬럼 (X좌표, Y좌표, 통행가능성 포함)
- **문제**: 스키마 문서가 실제 파일과 불일치
- **조치**: schema_registry.yaml 업데이트 필요
  - 누락된 컬럼 추가: `요충지여부`, `관측유리도`, `방어유리도`, `기동성등급`, `설명`
  - `좌표정보` 컬럼 추가 (선택적, X좌표/Y좌표와 병행 사용)
- **참고**: `docs/40_Refactoring/cop_visualization_design.md` 11.1.5절

**전장축선:**
- 실제: `주요지형셀목록` (string)
- 스키마: `구성지형셀목록` (list)
- **문제**: 컬럼명 및 타입 불일치
- **조치**: 스키마 문서 수정 또는 실제 파일 수정 필요

**COA_Library:**
- 실제: `적대응전술`, `연계방책` 컬럼 존재
- 스키마: 해당 컬럼 없음 (제거됨으로 표시)
- **문제**: 실제 파일에 레거시 컬럼 존재
- **조치**: 실제 파일에서 제거 또는 스키마에 추가

**시나리오모음:**
- 실제: `enemy_type`, `terrain`, `threat_level` (영문)
- 스키마: `임무ID`, `위협ID`, `위협수준` (한글)
- **문제**: 컬럼명 언어 불일치
- **조치**: 통일 필요

**2. 테이블 내 유사 컬럼**

**위협상황:**
- `위협유형코드` vs `위협유형` - 의미 중복 가능성

**아군부대현황:**
- `전투력지수` vs `전투력` - 의미 중복 가능성
- `가용상태` vs `상태` - 의미 중복 가능성

### 8.2 즉시 조치 사항

#### 우선순위 1: 스키마 문서 업데이트
1. `schema_registry.yaml` 업데이트
   - 지형셀: 실제 컬럼 반영
   - 전장축선: `주요지형셀목록` 반영
   - COA_Library: `적대응전술`, `연계방책` 처리 결정
   - 시나리오모음: 컬럼명 통일

2. `excel_columns.json` 업데이트
   - 모든 테이블의 실제 컬럼 목록 반영

#### 우선순위 2: 명명 불일치 해결

**✅ 최종 결정 사항 (COP 시각화 설계안과 통합 검토 완료)**

1. **전투력 관련**
   - **결정**: 모든 테이블을 `전투력지수`로 통일
   - **이유**: 더 명확한 의미 전달, 시각화에서도 `전투력지수` 사용
   - **조치**:
     - 위협상황: `전투력` → 제거 또는 `전투력지수`로 변경
     - 아군부대현황: `전투력` → 제거 (이미 `전투력지수` 존재)
   - **참고**: `docs/40_Refactoring/cop_visualization_design.md` 14.1.2절

2. **이동속도 관련**
   - **결정**: 모든 테이블을 `이동속도_kmh`로 통일
   - **이유**: 단위 명시로 혼동 방지, 시각화에서도 단위 명시 필요
   - **조치**:
     - 위협상황: `이동속도` → `이동속도_kmh`로 변경
     - 아군부대현황: `이동속도` → `이동속도_kmh`로 변경
     - 적군부대현황: 이미 `이동속도_kmh` 사용 중 (유지)
   - **참고**: `docs/40_Refactoring/cop_visualization_design.md` 14.1.2절

3. **위협유형 관련**
   - **결정**: `위협유형코드`만 사용, `위협유형` 제거
   - **이유**: FK 관계 명확화, 위협유형_마스터와의 일관성 유지
   - **조치**:
     - 위협상황: `위협유형` 컬럼 제거
     - 시각화에서는 `위협유형코드` → 위협유형_마스터 조회 → 위협유형명 표시
   - **참고**: `docs/40_Refactoring/cop_visualization_design.md` 11.1.1절

4. **좌표 정보 관련**
   - **결정**: `좌표정보` 우선 사용, `X좌표`, `Y좌표`는 fallback
   - **이유**: 
     - `좌표정보`: 직접 좌표 (더 정확, GeoJSON 표준 형식)
     - `X좌표`, `Y좌표`: 지형셀 중심 좌표 (간접 좌표)
   - **조치**:
     - 좌표 해결 우선순위: `좌표정보` → StatusManager → 지형셀 → 축선
     - `좌표정보` 형식 표준화: "경도,위도" 형식으로 통일 (GeoJSON 표준)
   - **참고**: `docs/40_Refactoring/cop_visualization_design.md` 11.5.1절, 14.1.1절

#### 우선순위 3: 중복 컬럼 정리

**✅ 최종 결정 사항 (COP 시각화 설계안과 통합 검토 완료)**

1. **위협상황**
   - `위협유형` 제거 (위협유형코드만 사용) ✅
   - `전투력` 제거 (전투력지수로 통일) ✅
   - `시간` vs `발생시각`: `발생시각`만 사용, `시간` 제거 검토
   - **조치**: 
     - `위협유형` 컬럼 제거
     - `전투력` 컬럼 제거
     - `시간` 컬럼 제거 (또는 `발생시각`과 의미 구분 명확화)

2. **아군부대현황**
   - `전투력` 제거 (전투력지수로 통일) ✅
   - `가용상태` vs `상태`: 의미 구분 명확화 필요
     - `가용상태`: 부대 가용성 (Available/Unavailable)
     - `상태`: 부대 작전 상태 (Deployed/Moving/Engaged/Reserve)
   - **조치**:
     - `전투력` 컬럼 제거
     - `가용상태`와 `상태` 컬럼 의미 문서화 및 시각화에서 구분 사용

3. **적군부대현황**
   - `전투력지수` 유지 (아군부대현황과 동일 컬럼명, 일관성 유지)
   - `배치축선ID` vs `배치지형셀ID`: 둘 다 유지 (위치 정보 다중 표현, 시각화에서 모두 활용)

### 8.3 다음 단계

1. ✅ **완료**: 실제 Excel 파일 컬럼 확인
2. ✅ **완료**: 중복/상충 컬럼 분석
3. **다음**: 스키마 문서 업데이트
4. **다음**: FK 참조 무결성 검증
5. **다음**: 온톨로지 변환 검증

---

## 부록: 검증 스크립트 목록

### ✅ 완료된 스크립트

1. ✅ `scripts/check_excel_columns.py` - 실제 Excel 파일 컬럼 확인
2. ✅ `scripts/analyze_schema_issues.py` - 중복/상충 컬럼 분석
3. ✅ `scripts/validate_fk_integrity.py` - FK 참조 무결성 검증
   - **결과**: 16개 FK 관계 모두 정상 ✅

### 📝 작성 예정 스크립트

4. `scripts/validate_data_integrity.py` - 데이터 무결성 검증
   - PK 고유성 검증
   - 필수 컬럼 NULL 검증
   - 데이터 범위 검증

5. `scripts/validate_relation_mappings.py` - 관계 매핑 검증
   - relation_mappings.json의 관계 정의 검증
   - 추론 관계의 confidence 값 검증

6. `scripts/validate_ontology_conversion.py` - 온톨로지 변환 검증
   - Excel 데이터와 온톨로지 인스턴스 비교
   - 변환 누락 검출

7. `scripts/validate_ontology_schema.py` - 온톨로지 스키마 검증
   - schema.ttl의 스키마 정의 검증
   - instances.ttl의 인스턴스 검증

8. `scripts/validate_reasoning_rules.py` - 추론 규칙 검증
   - 추론 규칙 실행 및 결과 검증
   - confidence 값 검증

9. `scripts/validate_sparql_queries.py` - SPARQL 쿼리 검증
   - 주요 SPARQL 쿼리 실행 및 결과 검증

10. `scripts/validate_coa_search.py` - COA 검색 검증
    - 위협 기반 COA 검색 결과 검증

11. `scripts/validate_coa_scoring.py` - COA 점수 계산 검증
    - 평가 요소별 점수 계산 검증

---

## 9. Phase 1 검증 결과 요약 (2025-01-08)

### 9.1 완료된 검증

✅ **실제 Excel 파일 컬럼 확인**
- 16개 테이블 확인 완료
- excel_columns.json과 5개 테이블 불일치 발견

✅ **중복/상충 컬럼 분석**
- 테이블 내 중복: 위협상황, 아군부대현황
- 명명 불일치: 전투력, 이동속도, 위협유형

✅ **FK 참조 무결성 검증**
- 16개 FK 관계 모두 정상 ✅
- 고아 레코드 없음 ✅

### 9.2 발견된 주요 문제점

#### High Priority
1. **명명 불일치**: 전투력, 이동속도, 위협유형
2. **스키마 문서 불일치**: 지형셀, 전장축선, COA_Library

#### Medium Priority
1. **중복 컬럼**: 위협상황(위협유형), 아군부대현황(전투력, 상태)
2. **레거시 컬럼**: COA_Library(연계방책, 적대응전술)

### 9.3 다음 단계

1. **스키마 문서 업데이트** (우선순위 1) - ✅ 진행 중
   - [ ] schema_registry.yaml: 필드명 통일 반영
   - [ ] excel_columns.json: 실제 컬럼 목록 반영
   - [ ] 좌표 정보 형식 표준화

2. **데이터 무결성 검증** (우선순위 2)
   - [ ] 필수 컬럼 NULL 검증
   - [ ] 데이터 범위 검증
   - [ ] 좌표 정보 파싱 검증

3. **온톨로지 변환 검증** (우선순위 3)
   - [ ] Excel → RDF 변환 검증
   - [ ] 스키마-인스턴스 일치성 검증

4. **시각화 데이터 구조 확장** (우선순위 4)
   - [ ] 위협유형별 반경 매핑 테이블 추가
   - [ ] 방책 작전 경로/영역 생성 로직 구현
   - [ ] 참고: `docs/40_Refactoring/cop_visualization_design.md` 14.2절

---

## 10. COP 시각화 데이터 요구사항 (2025-01-XX)

### 10.1 개요

**목적**: COP(Common Operational Picture) 시각화를 위한 데이터 구조 및 검증 요구사항 정의

**참고 문서**: 
- 설계 문서: `docs/40_Refactoring/cop_visualization_design.md`
- 구현 요약: `docs/40_Refactoring/cop_visualization_implementation_summary.md`

### 10.2 필수 데이터 필드 검증

#### 10.2.1 위협상황 테이블

**시각화에 필수인 필드**:
- ✅ `위협ID` (PK): 위협 식별자
- ✅ `위협유형코드`: MIL-STD-2525D 심볼 결정용
- ✅ `위협수준`: 영향 범위 반경 계산용 (0.0 ~ 1.0, 숫자 타입 권장)
- ✅ `발생위치셀ID` (FK → 지형셀): 위치 해결용
- ✅ `관련축선ID` (FK → 전장축선): 축선 정보
- ✅ `좌표정보`: 직접 좌표 (형식: "경도,위도", 예: "127.0,37.5")
- ✅ `발생시각`: 타임라인 시각화용 (ISO 8601 형식 권장)

**검증 항목**:
- [ ] `위협수준` 필드 타입 확인 (문자열 vs 숫자) → 숫자로 통일 권장
- [ ] `좌표정보` 필드 형식 표준화 ("경도,위도" 형식으로 통일)
- [ ] `발생위치셀ID` 참조 무결성 확인
- [ ] `관련축선ID` 참조 무결성 확인

#### 10.2.2 아군부대현황 테이블

**시각화에 필수인 필드**:
- ✅ `아군부대ID` (PK): 부대 식별자
- ✅ `부대명`: 마커 라벨
- ✅ `제대`, `병종`: MIL-STD-2525D 심볼 결정용
- ✅ `배치지형셀ID` (FK → 지형셀): 위치 해결용
- ✅ `배치축선ID` (FK → 전장축선): 축선 정보
- ✅ `좌표정보`: 직접 좌표 (형식: "경도,위도")
- ✅ `전투력지수`: 부대 전투력 표시용
- ✅ `가용상태`: 부대 상태 표시용

**검증 항목**:
- [ ] `좌표정보` 필드 형식 표준화
- [ ] `배치지형셀ID` 참조 무결성 확인
- [ ] `배치축선ID` 참조 무결성 확인
- [ ] `제대`, `병종` 조합으로 MIL-STD-2525D 심볼 매핑 가능 여부 확인

#### 10.2.3 전장축선 테이블

**시각화에 필수인 필드**:
- ✅ `축선ID` (PK): 축선 식별자
- ✅ `축선명`: 라벨 표시용
- ✅ `축선유형`: PRIMARY/SECONDARY/SUPPORT 구분용
- ✅ `주요지형셀목록`: 축선 경로 좌표 계산용 (콤마 구분 문자열)
- ✅ `시작지형셀ID` (FK → 지형셀): 시작점 좌표
- ✅ `종단지형셀ID` (FK → 지형셀): 종단점 좌표

**검증 항목**:
- [ ] `주요지형셀목록` 필드 존재 및 형식 확인 (콤마 구분 문자열)
- [ ] `축선유형` 필드 값 확인 (PRIMARY/SECONDARY/SUPPORT 또는 한글: 주공/조공/지원)
- [ ] `시작지형셀ID`, `종단지형셀ID` 참조 무결성 확인
- [ ] `주요지형셀목록`의 지형셀ID 참조 무결성 확인

#### 10.2.4 지형셀 테이블

**시각화에 필수인 필드**:
- ✅ `지형셀ID` (PK): 지형셀 식별자
- ✅ `좌표정보`: 직접 좌표 (형식: "경도,위도", 우선순위 1)
- ✅ `X좌표`, `Y좌표`: 지형셀 중심 좌표 (우선순위 2, fallback)

**검증 항목**:
- [ ] `좌표정보` 필드 형식 표준화 ("경도,위도" 형식)
- [ ] `X좌표`, `Y좌표` vs `좌표정보` 우선순위 결정 (좌표정보 우선)
- [ ] 좌표 데이터 존재 여부 확인 (NULL 값 최소화)

### 10.3 시각화 데이터 생성 요구사항

#### 10.3.1 방책 작전 경로 (operational_path)

**필수 정보**:
- 출발지: 아군 부대 배치 위치
- 경유지: 주요 축선상의 지형셀 좌표
- 목표지: 위협 위치 또는 작전 목표
- 경로 타입: MOVEMENT/ATTACK/DEFENSE/SUPPORT

**데이터 소스**:
- `COA.unit_assignments`: 참여 부대 정보
- `아군부대현황`: 부대 위치 정보
- `전장축선`: 축선 좌표 정보
- `위협상황`: 위협 위치 정보

**검증 항목**:
- [ ] 참여 부대의 위치 정보 존재 여부 확인
- [ ] 주요 축선 좌표 해결 가능 여부 확인
- [ ] 위협 위치 정보 존재 여부 확인

#### 10.3.2 방책 작전 영역 (operational_area)

**필수 정보**:
- 배치 영역: 부대 배치 위치 중심 원형 영역 (Polygon)
- 교전 영역: 위협 위치와 부대 위치 사이 버퍼 영역 (Polygon)

**데이터 소스**:
- `COA.unit_assignments`: 참여 부대 정보
- `아군부대현황`: 부대 위치 정보
- `위협상황`: 위협 위치 정보

**검증 항목**:
- [ ] 참여 부대의 위치 정보 존재 여부 확인
- [ ] 위협 위치 정보 존재 여부 확인

#### 10.3.3 축선 좌표 정보 (axis_states)

**필수 정보**:
- 축선 좌표 경로: `주요지형셀목록` → 지형셀 좌표 변환
- 축선 타입: PRIMARY/SECONDARY/SUPPORT
- 축선명: 라벨 표시용

**데이터 소스**:
- `전장축선`: 축선 정의
- `지형셀`: 지형셀 좌표

**검증 항목**:
- [ ] `주요지형셀목록` 필드 존재 및 파싱 가능 여부 확인
- [ ] 지형셀 좌표 조회 가능 여부 확인
- [ ] 축선 타입 정보 존재 여부 확인

### 10.4 좌표 해결 우선순위

**표준 우선순위** (설계 문서 11.5.1절 참조):

1. **1순위**: 직접 좌표 (`좌표정보` 필드 파싱)
   - 형식: "경도,위도" (예: "127.0,37.5")
   - 파싱 로직: `parseCoordinates()` 함수 사용

2. **2순위**: StatusManager 실시간 좌표
   - 동적 부대 위치 추적용 (선택적)

3. **3순위**: 지형셀 좌표 (`배치지형셀ID` → 지형셀 → `X좌표`, `Y좌표`)
   - 지형셀 중심 좌표 사용

4. **4순위**: 축선 좌표 (`배치축선ID` → 전장축선 → 시작/종단 지형셀 → 좌표)
   - 축선의 시작점 또는 중간점 사용

5. **5순위**: 기본 위치 (LOCATION_DB 또는 하드코딩)
   - 최후의 수단

**검증 항목**:
- [ ] 각 우선순위별 좌표 해결 로직 테스트
- [ ] 좌표 정보 누락 시 fallback 동작 확인
- [ ] 좌표 형식 일관성 확인

### 10.5 MIL-STD-2525D 심볼 매핑 요구사항

#### 10.5.1 아군 부대 심볼

**매핑 기준**:
- `제대` + `병종` 조합
- 예: "사단" + "기갑" → `SFGPUCA----K---` (Friendly Ground Unit, Combat Armor)

**필수 매핑**:
- 보병: `SFGPUCI----K---`
- 기갑: `SFGPUCA----K---`
- 포병: `SFGPUCF----K---`
- 공군: `SFAPUCI----K---`
- 미사일: `SFGPUCM----K---`

**검증 항목**:
- [ ] `제대`, `병종` 필드 값 확인
- [ ] 매핑 테이블 완성도 확인
- [ ] 기본값 처리 로직 확인

#### 10.5.2 위협 심볼

**매핑 기준**:
- `위협유형코드` → 위협유형_마스터 조회 → SIDC 결정
- 또는 직접 `위협유형코드` → SIDC 매핑

**필수 매핑**:
- 미사일: `SHGPUCM----K---`
- 포병: `SHGPUCF----K---`
- 기갑: `SHGPUCA----K---`
- 보병: `SHGPUCI----K---`
- 공중: `SHAPUCI----K---`**검증 항목**:
- [ ] `위협유형코드` 필드 값 확인
- [ ] 위협유형_마스터 테이블과의 일관성 확인
- [ ] 매핑 테이블 완성도 확인

### 10.6 위협 영향 범위 계산 요구사항

#### 10.6.1 반경 계산 공식

```
기본 반경 = 5.0 km
위협 수준 가중치 = 1.0 + 위협수준 (1.0 ~ 2.0)
위협 유형별 추가 반경:
  - 미사일: +10.0 km
  - 포병: +8.0 km
  - 기갑: +5.0 km
  - 보병: +3.0 km
  - 공중: +15.0 km
  - 해상: +12.0 km

최종 반경 = (기본 반경 × 위협 수준 가중치) + 위협 유형별 추가 반경
최대 반경 제한: 50.0 km
```

**검증 항목**:
- [ ] `위협수준` 필드 타입 확인 (숫자 타입 권장)
- [ ] `위협유형코드` 값 확인
- [ ] 위협유형별 반경 매핑 테이블 존재 여부 확인

#### 10.6.2 색상 매핑

**위협 수준별 색상**:
- 0.0 ~ 0.3: 초록색 (#22c55e, opacity: 0.1)
- 0.3 ~ 0.6: 노란색 (#eab308, opacity: 0.15)
- 0.6 ~ 0.8: 주황색 (#f97316, opacity: 0.2)
- 0.8 ~ 1.0: 빨간색 (#ef4444, opacity: 0.3)

**검증 항목**:
- [ ] `위협수준` 값 범위 확인 (0.0 ~ 1.0)
- [ ] 색상 매핑 로직 테스트

### 10.7 방책별 색상 구분 요구사항

**Rank별 색상**:
- Rank 1: 파란색 (#3b82f6)
- Rank 2: 초록색 (#10b981)
- Rank 3: 보라색 (#8b5cf6)
- 선택된 방책: 빨간색 (#ef4444)

**검증 항목**:
- [ ] COA Rank 정보 존재 여부 확인
- [ ] 색상 매핑 로직 테스트

### 10.8 데이터 검증 체크리스트

#### 즉시 확인 필요 사항 (우선순위 1)

- [ ] **좌표 정보 일관성**
  - `좌표정보` 필드 형식 표준화 ("경도,위도" 형식으로 통일)
  - `X좌표`, `Y좌표` vs `좌표정보` 우선순위 결정 (좌표정보 우선)
  - 좌표 파싱 로직 통일

- [ ] **필드명 통일**
  - `전투력지수` vs `전투력` 통일 (전투력지수로 통일)
  - `이동속도` vs `이동속도_kmh` 통일 (이동속도_kmh로 통일)
  - `주요지형셀목록` vs `구성지형셀목록` 통일 (주요지형셀목록으로 통일)

- [ ] **데이터 타입 확인**
  - `위협수준` 필드 타입 확인 (문자열 vs 숫자) → 숫자로 통일 권장
  - 좌표 필드 타입 확인 (문자열 vs 숫자)

#### 추가 데이터 생성 필요 (우선순위 2)

- [ ] **위협유형별 반경 매핑 테이블**
  - `위협유형_마스터.xlsx`에 `기본반경_km` 컬럼 추가 권장
  - 또는 코드 내 매핑 테이블 유지

- [ ] **방책 작전 경로 waypoints 생성**
  - 백엔드에서 방책 추천 시 `visualization_data.operational_path` 자동 생성
  - 출발지: `participating_units`의 부대 위치
  - 경유지: `main_axis_id` 기반 축선 좌표
  - 목표지: 위협 위치

- [ ] **방책 작전 영역 polygon 생성**
  - 백엔드에서 방책 추천 시 `visualization_data.operational_area` 자동 생성
  - 배치 영역: 부대 배치 위치 중심 반경 계산
  - 교전 영역: 위협 위치와 부대 위치 사이 버퍼 영역

### 10.9 구현 상태

#### ✅ 완료된 기능

1. **프론트엔드 시각화 컴포넌트**
   - 위협 영향 범위 (Circle) 시각화
   - 아군 부대 마커 (MIL-STD-2525D)
   - 위협 마커 (MIL-STD-2525D)
   - 방책별 색상 구분
   - 축선 라인 표시
   - 방책 작전 경로 (Polyline)
   - 방책 작전 영역 (Polygon)
   - 레이어 토글 기능

2. **백엔드 시각화 데이터 생성**
   - 축선 좌표 해결 로직
   - 방책 작전 경로 생성
   - 방책 작전 영역 생성
   - axis_states 좌표 정보 추가

#### ⚠️ 확인 필요 사항

1. **데이터 검증**
   - [ ] 실제 데이터로 시각화 테스트
   - [ ] 좌표 정보 파싱 정확도 확인
   - [ ] 축선 좌표 해결 성공률 확인

2. **성능 최적화**
   - [ ] 많은 마커가 있을 때 성능 테스트
   - [ ] 마커 클러스터링 필요 여부 확인

3. **추가 기능**
   - [ ] 타임라인 기능 (선택적)
   - [ ] 방책 비교 모드 (선택적)

### 10.10 테스트 스크립트

**테스트 스크립트**: `scripts/test_cop_visualization.py`

**테스트 항목**:
1. 축선 좌표 해결 테스트
2. 지형셀 좌표 조회 테스트
3. 방책 작전 경로 생성 테스트
4. 방책 작전 영역 생성 테스트
5. 시각화 데이터 요구사항 확인

**실행 방법**:
```bash
python scripts/test_cop_visualization.py
```

### 10.11 테스트 결과 요약

**테스트 일자**: 2025-01-XX  
**테스트 스크립트**: 
- `scripts/test_cop_visualization.py` - 단위 테스트
- `scripts/test_cop_integration_simple.py` - 통합 테스트

**테스트 결과**:
- ✅ **축선 좌표 해결**: 3/3 성공 (AXIS01, AXIS02, AXIS03)
  - 주요지형셀목록 → 지형셀 좌표 변환 정상 작동
  - 축선 메타데이터 추출 정상 작동
  
- ✅ **방책 작전 경로 생성**: 성공
  - 출발지(아군 부대) → 경유지(축선) → 목표지(위협) 경로 생성
  - 경로 타입 자동 결정 (MOVEMENT/ATTACK/DEFENSE/SUPPORT)
  
- ✅ **방책 작전 영역 생성**: 성공
  - 배치 영역: 부대 배치 위치 중심 원형 영역 (33개 좌표)
  - 교전 영역: 위협-부대 사이 버퍼 영역 (5개 좌표)
  
- ✅ **지형셀 좌표 조회**: 정상 작동
  - 좌표정보 필드 우선 사용
  - X좌표/Y좌표 fallback 정상 작동

**발견된 이슈**:
- ⚠️ `위협수준` 필드 타입 확인 필요 (문자열 vs 숫자)
  - **영향**: 영향 범위 계산 시 숫자 변환 필요
  - **해결**: 프론트엔드에서 파싱 로직 적용 (이미 구현됨)
  
- ⚠️ 일부 레코드에 `좌표정보` 필드 누락 가능성
  - **영향**: 위치 해결 실패 가능성
  - **해결**: fallback 로직 적용 (지형셀 → 축선 우선순위)

**구현 완료 사항**:
- ✅ 좌표 형식 자동 변환 로직 추가 ([lng, lat] ↔ [lat, lng])
- ✅ 참여 부대 정보 조회 개선 (data_manager 통합)
- ✅ 시각화 데이터 자동 생성 (COA API 통합)

**상세 보고서**: 
- `docs/40_Refactoring/cop_visualization_test_report.md` - 테스트 결과 상세
- `docs/40_Refactoring/cop_visualization_test_guide.md` - 수동 테스트 가이드

### 10.12 참고 자료

- **설계 문서**: `docs/40_Refactoring/cop_visualization_design.md`
- **구현 요약**: `docs/40_Refactoring/cop_visualization_implementation_summary.md`
- **테스트 보고서**: `docs/40_Refactoring/cop_visualization_test_report.md`
- **MIL-STD-2525D**: https://www.milsymbol.net/
- **Leaflet 문서**: https://leafletjs.com/
- **react-leaflet 문서**: https://react-leaflet.js.org/
