# 방책 분석 진행 상황 표시 개선

## 문제 상황
방책추천 실행버튼 클릭 후 방책 분석이 진행되는 동안 화면이 어두워지면서 멈춰 있어, 사용자는 분석이 진행되고 있는지 알 수 없어 답답함을 느낌.

## 해결 방안

### 1. 진행 상황 박스 자동 확장 (`expanded=True`)
- **변경 전**: `st.status(..., expanded=False)` - 진행 상황이 접힌 상태로 표시되어 사용자가 확인할 수 없음
- **변경 후**: `st.status(..., expanded=True)` - 진행 상황이 자동으로 펼쳐진 상태로 표시됨

### 2. 진행율 바(Progress Bar) 추가
- **시각적 피드백**: 0~100% 범위의 진행율을 시각적으로 표시
- **실시간 업데이트**: 각 분석 단계마다 진행율이 업데이트됨
  - 상황 분석: 0-25%
  - 방책 검색 및 점수 계산: 25-70%
  - LLM 기반 구체화: 70-85%
  - 최종 결과 생성: 85-100%

### 3. 진행율 텍스트 표시
- 숫자로 명확한 진행 상태 표시 (예: "진행율: 45%")

### 4. 시각적 개선
- **Progress Bar 스타일**: 그라디언트 효과로 더 눈에 띄게 표시
- **Status Box 강조**: 파란색 테두리로 진행 중 상태 강조
- **펄스 애니메이션**: 진행 중일 때 부드러운 애니메이션 효과로 "진행 중"임을 명확히 전달

## 개선된 사용자 경험

### Before (이전)
```
[어두운 화면]
방책을 분석하고 있습니다... ▶  <- 접혀있음, 무슨 일이 일어나는지 모름
```

### After (개선 후)
```
방책을 분석하고 있습니다... ▼  <- 자동으로 펼쳐짐
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 45%  <- Progress bar
진행율: 45%  <- 명확한 숫자 표시

  - [10%] 전술 상황 분석 및 위협 요소 식별 중...
  - [25%] 임무별 최적 방책 유형 및 대응 전략 수립 중...
  - [45%] 방책 유형 분석 완료: DEFENSE  <- 현재 진행 중인 단계
```

## 기술적 변경 사항

### 파일: `ui/views/agent_execution.py`

#### 1. Progress Bar 생성 (Line 383-385)
```python
with st.status("방책을 분석하고 있습니다...", expanded=True) as status:
    progress_bar = st.progress(0)
    progress_text = st.empty()
```

#### 2. 실시간 업데이트 (Line 418-420)
```python
progress_bar.progress(current_progress / 100.0)
progress_text.text(f"진행율: {current_progress}%")
st.write(log_entry)
```

#### 3. 완료 상태 표시 (Line 446-448)
```python
progress_bar.progress(1.0)
progress_text.text("진행율: 100%")
status.update(label=final_label, state="complete")
```

#### 4. CSS 스타일 추가 (Line 126-154)
- Progress bar 그라디언트 스타일
- Status box 강조 스타일
- 펄스 애니메이션 효과

## 진행율 단계

| 진행율 | 단계 | 설명 |
|--------|------|------|
| 0% | 시작 | 방책 분석 시작 |
| 5-10% | 온톨로지 로드 | 데이터 로드 및 지식 그래프 구축 |
| 10% | 상황 분석 | 전술 상황 분석 및 위협 요소 식별 |
| 20-25% | 방책 검색 | 통합 후보 검색 및 병렬 최적화 |
| 25-70% | 점수 계산 | 방책 유형별 점수 계산 (병렬 처리) |
| 70% | 종합 평가 | 추천 방책 종합 점수 계산 및 최종 순위 생성 |
| 85% | LLM 구체화 | LLM 기반 방책 구체화 (상황별 맞춤) |
| **90-95%** | **선정사유 생성** | **각 방책별 LLM 기반 선정사유 생성 (NEW)** |
| 100% | 완료 | 방책 분석 및 추천 완료 |

## 주의사항
- 진행율은 `logic_defense_enhanced.py`의 `_report_status` 메서드에서 전달되는 값에 따라 업데이트됩니다
- 네트워크 지연이나 LLM 응답 시간에 따라 특정 단계에서 시간이 더 걸릴 수 있습니다
- 진행율이 일시적으로 멈춘 것처럼 보이더라도 백그라운드에서 계산이 진행 중입니다

## 테스트 방법
1. Streamlit 앱 실행: `python run_streamlit.py --log-to-file`
2. "지휘통제/분석" 페이지로 이동
3. 상황 정보 설정
4. "🎯 방책 추천 실행" 버튼 클릭
5. 진행 상황 박스가 자동으로 펼쳐지고 진행율이 표시되는지 확인

## 관련 파일
- `ui/views/agent_execution.py` - UI 개선 코드
- `agents/defense_coa_agent/logic_defense_enhanced.py` - 진행율 보고 로직
