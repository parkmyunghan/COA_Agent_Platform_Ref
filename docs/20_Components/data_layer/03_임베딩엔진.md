# 임베딩 엔진 (rogel-embedding-v2)

## 1. 개요

- **역할**: 텍스트를 벡터로 변환 (임베딩 생성)
- **위치**: Data Layer
- **모델**: `rogel-embedding-v2`
- **다이어그램 표시**: "임베딩 엔진 (rogel-embedding-v2)"

임베딩 엔진은 전문 문서와 온톨로지 인스턴스를 벡터 공간으로 변환하여 의미 기반 검색을 가능하게 합니다. RAGManager를 통해 사용됩니다.

---

## 2. 주요 기능

### 2.1 텍스트 임베딩 생성
- 문서를 고차원 벡터로 변환
- 의미적 유사도 계산 가능
- 벡터 크기: 1024차원

### 2.2 배치 처리
- 여러 문서를 한 번에 임베딩 생성
- GPU 가속 지원 (선택적)

### 2.3 모델 관리
- 모델 로드 및 캐싱
- GPU/CPU 자동 선택

---

## 3. 구현 상세

### 3.1 사용 위치
임베딩 엔진은 RAGManager를 통해 사용됩니다:

```python
# core_pipeline/rag_manager.py
class RAGManager:
    def load_embeddings(self, model_path: Optional[str] = None):
        """임베딩 모델 로드"""
        # rogel-embedding-v2 모델 로드
```

### 3.2 주요 메서드

#### `compute_embeddings(texts: List[str]) -> np.ndarray`
텍스트 리스트를 벡터로 변환합니다.

```python
# 사용 예시
rag_manager = RAGManager(config)
rag_manager.load_embeddings()

texts = ["위협 상황 침투", "방어 방책 추천"]
embeddings = rag_manager.compute_embeddings(texts)
# 결과: (2, 1024) shape의 numpy 배열
```

---

## 4. 데이터 흐름

```
전문 문서 (PDF/Text)
    ↓
RAGManager.chunk_documents()
    ↓
임베딩 엔진 (rogel-embedding-v2)
    ↓
벡터 생성 (1024차원)
    ↓
FAISS 인덱스 구축
    ↓
벡터 DB 저장
```

---

## 5. 설정 및 파라미터

### 5.1 설정 파일
- **위치**: `config/model_config.yaml`
- **설정**:
  ```yaml
  embedding:
    model_name: "rogel-embedding-v2"
    model_path: "./models/embedding/rogel-embedding-v2"
    vector_size: 1024
    index_path: "./knowledge/embeddings/faiss_index.bin"
  ```

### 5.2 모델 정보
- **모델명**: rogel-embedding-v2
- **벡터 크기**: 1024차원
- **언어**: 한국어 최적화

---

## 6. 사용 예시

### 6.1 RAGManager를 통한 사용
```python
from core_pipeline.rag_manager import RAGManager

# 초기화
config = {"embedding_path": "./knowledge/embeddings"}
rag_manager = RAGManager(config)

# 임베딩 모델 로드
rag_manager.load_embeddings()

# 문서 임베딩 생성
documents = ["문서 1 내용", "문서 2 내용"]
embeddings = rag_manager.compute_embeddings(documents)
```

### 6.2 검색에서 사용
```python
# 쿼리 임베딩 생성
query = "위협 상황 침투"
query_embedding = rag_manager.compute_embeddings([query])[0]

# FAISS를 통한 유사 문서 검색
distances, indices = rag_manager.faiss_index.search(
    query_embedding.reshape(1, -1).astype('float32'),
    top_k=5
)
```

---

## 7. 관련 컴포넌트

### 7.1 입력
- **전문 문서**: PDF, Text 파일
- **온톨로지 인스턴스**: RDF 그래프의 인스턴스 데이터

### 7.2 출력
- **벡터 DB (FAISS)**: 임베딩 벡터 저장
- **RAGManager**: 유사 문서 검색에 사용

---

## 8. 참고 자료

- **코드 위치**: `core_pipeline/rag_manager.py`
- **관련 문서**: 
  - `docs/방책추천_시스템.md`
- **설정 파일**: 
  - `config/model_config.yaml`
  - `config/rag_config.yaml`

---

## 9. 중요 사항

### 9.1 GPU 지원
GPU가 사용 가능하면 자동으로 GPU에 모델을 로드하여 성능을 향상시킵니다.

### 9.2 배치 처리
여러 문서를 한 번에 임베딩 생성하여 효율성을 높입니다.

---

**작성일**: 2025년 12월  
**버전**: 1.0

