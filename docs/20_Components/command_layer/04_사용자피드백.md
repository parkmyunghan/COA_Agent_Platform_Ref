# 사용자 피드백

## 1. 개요

- **역할**: 사용자의 추천 결과에 대한 피드백 수집
- **위치**: Command Layer
- **컴포넌트**: `core_pipeline.workflow_manager.WorkflowManager`
- **다이어그램 표시**: "사용자 피드백"

사용자 피드백은 추천된 방책에 대한 사용자의 평가와 의견을 수집하여 시스템 개선에 활용합니다. 승인 워크플로우와 연계되어 의사결정 프로세스를 지원합니다.

---

## 2. 주요 기능

### 2.1 피드백 수집
- 방책 선택 여부
- 평가 점수 (1-5점)
- 의견 및 코멘트
- 실행 결과 (선택적)

### 2.2 승인 워크플로우
- 승인 요청 생성
- 검토 의견 추가
- 승인/거부 처리

### 2.3 학습 데이터 수집
- 추천 점수 vs 실제 평가 비교
- 사용자 선호도 프로파일링
- COA 효과성 통계 업데이트

---

## 3. 구현 상세

### 3.1 클래스 위치
```python
# core_pipeline/workflow_manager.py
class WorkflowManager:
    """워크플로우 관리 클래스"""
```

### 3.2 주요 메서드

#### `create_approval_request(recommendation, requester_id, approver_id) -> str`
승인 요청을 생성합니다.

```python
# 사용 예시
workflow_manager = WorkflowManager()
request_id = workflow_manager.create_approval_request(
    recommendation=recommendation,
    requester_id="user001",
    approver_id="commander001"
)
```

#### `add_review_comment(request_id, reviewer_id, comment, rating)`
검토 의견을 추가합니다.

```python
# 사용 예시
workflow_manager.add_review_comment(
    request_id=request_id,
    reviewer_id="reviewer001",
    comment="이 방책은 자원 소요가 과다함",
    rating=3
)
```

---

## 4. 데이터 흐름

```
방책 결과 시각화
    ↓
사용자 평가
    ├─→ 선택 여부
    ├─→ 평가 점수
    └─→ 의견 입력
    ↓
WorkflowManager
    ├─→ 승인 요청 생성
    └─→ 피드백 저장
    ↓
Orchestrator (조정)
    ├─→ 가중치 조정 (향후)
    └─→ 학습 데이터 수집
```

---

## 5. 설정 및 파라미터

### 5.1 피드백 형식
```python
feedback = {
    "coa_id": "COA_DEF_001",
    "recommended_score": 0.85,
    "user_rating": 4,  # 1-5 scale
    "selected": True,
    "comment": "자원 소요가 과다하지만 효과적임",
    "actual_outcome": "성공"  # 실행 후 결과
}
```

### 5.2 승인 워크플로우 상태
- **pending_review**: 검토 대기
- **under_review**: 검토 중
- **approved**: 승인됨
- **rejected**: 거부됨

---

## 6. 사용 예시

### 6.1 기본 사용
```python
# ui/components/approval_workflow.py
from core_pipeline.workflow_manager import WorkflowManager

workflow_manager = WorkflowManager()

# 승인 요청 생성
request_id = workflow_manager.create_approval_request(
    recommendation=recommendation,
    requester_id=user_id
)

# 검토 의견 추가
workflow_manager.add_review_comment(
    request_id=request_id,
    reviewer_id=reviewer_id,
    comment="검토 의견",
    rating=4
)
```

### 6.2 피드백 수집
```python
# 사용자 평가 수집
user_feedback = {
    "coa_id": selected_coa_id,
    "rating": st.slider("평가", 1, 5, 3),
    "comment": st.text_area("의견")
}
```

---

## 7. 관련 컴포넌트

### 7.1 입력
- **방책 결과 시각화**: 추천 결과
- **사용자**: 평가 및 의견

### 7.2 출력
- **Orchestrator**: 피드백 반영 (조정)
- **학습 시스템**: 가중치 조정 (향후)

---

## 8. 참고 자료

- **코드 위치**: 
  - `core_pipeline/workflow_manager.py`
  - `ui/components/approval_workflow.py`
- **관련 문서**: 
  - `docs/방책추천_시스템.md`

---

## 9. 중요 사항

### 9.1 향후 개선
피드백 데이터를 활용한 강화 학습(Reinforcement Learning)을 통해 점수 가중치를 자동 조정할 수 있습니다.

### 9.2 의사결정 지원
승인 워크플로우를 통해 체계적인 의사결정 프로세스를 지원합니다.

---

**작성일**: 2025년 12월  
**버전**: 1.0

