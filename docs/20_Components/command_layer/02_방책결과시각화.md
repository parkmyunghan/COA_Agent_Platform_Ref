# 방책 결과 시각화 (Top 3)

## 1. 개요

- **역할**: 추천된 방책을 상위 3개로 시각화
- **위치**: Command Layer
- **컴포넌트**: `ui.components.recommendation_visualization`
- **다이어그램 표시**: "방책 결과 시각화 (Top 3)"

방책 결과 시각화는 Agent가 추천한 방책을 점수 순으로 정렬하여 상위 3개를 사용자 친화적인 형태로 표시합니다. 각 방책의 점수 breakdown과 추천 이유를 제공합니다.

---

## 2. 주요 기능

### 2.1 상위 3개 방책 표시
- 점수 순으로 정렬
- 카드 형태로 시각화
- 점수에 따른 색상 구분

### 2.2 점수 Breakdown 시각화
- 7가지 요소별 점수 표시
- 가중 점수 계산
- 진행 바(Progress Bar)로 시각화

### 2.3 추천 근거 제공
- 요소별 상세 평가
- 추천 이유 텍스트
- Graphviz를 통한 논리 구조 시각화

---

## 3. 구현 상세

### 3.1 컴포넌트 위치
```python
# ui/components/recommendation_visualization.py
def render_recommendation_breakdown(recommendation, agent_result=None):
    """추천 근거 breakdown 시각화"""
```

### 3.2 주요 함수

#### `render_recommendation_breakdown(recommendation, agent_result)`
추천 결과를 시각화합니다.

```python
# 사용 예시
recommendation = {
    "coa_name": "방어 진지 구축",
    "score": 0.85,
    "score_breakdown": {
        "threat": 0.85,
        "resources": 0.70,
        "assets": 0.80,
        ...
    },
    "reasoning": "위협 수준 85%에 대한 대응 점수가 높아 추천됩니다."
}

render_recommendation_breakdown(recommendation)
```

---

## 4. 데이터 흐름

```
Agent (추천 결과)
    ↓
점수 순 정렬
    ↓
상위 3개 선택
    ↓
render_recommendation_breakdown()
    ├─→ 점수 Breakdown 표시
    ├─→ 추천 이유 표시
    └─→ Graphviz 논리 구조 시각화
    ↓
사용자 인터페이스 표시
```

---

## 5. 시각화 요소

### 5.1 점수 색상 구분
- **0.8 이상**: 녹색 (매우 우수)
- **0.6 ~ 0.8**: 노란색 (양호)
- **0.4 ~ 0.6**: 주황색 (보통)
- **0.4 미만**: 빨간색 (부족)

### 5.2 Graphviz 논리 구조
- 중심 노드: 방책명 및 총점
- 요소 노드: 7가지 평가 요소
- 가중치 표시: 화살표에 가중치 표시

---

## 6. 사용 예시

### 6.1 기본 사용
```python
# ui/components/dashboard_tab_situation.py
recommendations = agent_result.get("recommendations", [])

# 상위 3개 표시
for i, rec in enumerate(recommendations[:3], 1):
    render_recommendation_breakdown(rec, agent_result)
```

### 6.2 점수 Breakdown 표시
```python
score_breakdown = recommendation.get("score_breakdown", {})
# 요소별 점수 표시
for key, score in score_breakdown.items():
    st.metric(key, f"{score:.3f}")
```

---

## 7. 관련 컴포넌트

### 7.1 입력
- **Agent**: 추천 결과 제공

### 7.2 출력
- **사용자 인터페이스**: 시각화된 결과 표시
- **전략 체인 시각화**: 체인 정보 전달

---

## 8. 참고 자료

- **코드 위치**: `ui/components/recommendation_visualization.py`
- **관련 문서**: 
  - `docs/방책추천_시스템.md`
  - `docs/점수_산정_시스템.md`

---

## 9. 중요 사항

### 9.1 상위 3개 선택
점수가 높은 순서대로 상위 3개만 표시하여 사용자의 의사결정을 지원합니다.

### 9.2 투명성
점수 breakdown과 추천 이유를 제공하여 추천의 근거를 명확히 합니다.

---

**작성일**: 2025년 12월  
**버전**: 1.0

