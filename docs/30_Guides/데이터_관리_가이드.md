# 💾 데이터 관리 가이드 (Data Management Guide)

데이터 품질 검사 및 온톨로지 생성을 위한 **테이블정의서 작성 표준** 가이드입니다. 시스템이 엑셀 파일을 올바르게 인식하고 지식 그래프로 변환하기 위해서는 이 규칙을 준수해야 합니다.

---

## 📋 목차

1. [테이블정의서란?](#1-테이블정의서란)
2. [작성 구조 및 규칙](#2-작성-구조-및-규칙)
3. [필수 컬럼 상세](#3-필수-컬럼-상세)
4. [작성 예시](#4-작성-예시)
5. [데이터 검증 및 적용](#5-데이터-검증-및-적용)

---

## 1. 테이블정의서란?

각 데이터 엑셀 파일(`data_lake/*.xlsx`)의 **두 번째 시트**에 위치하며, 데이터의 스키마(구조, 타입, 관계)를 정의하는 메타데이터입니다.

- **시트명**: `테이블정의서` (권장), `정의서`, `Schema` 중 하나 사용
- **역할**:
    - 데이터 유효성 검사 (타입, 필수값, 범위 체크)
    - 온톨로지 자동 생성 (클래스, 속성, 관계 정의)

---

## 2. 작성 구조 및 규칙

### 2.1 기본 템플릿

| 필드명 | 타입 | 설명 | FK | 관계 |
|--------|------|------|----|----|
| [컬럼명] | [타입] | [PK, 범위 등] | Y/N | [테이블:컬럼] |

### 2.2 작성 규칙 요약 (Checklist)

1.  **필드명 일치**: 정의서의 `필드명`은 데이터 시트(첫 번째 시트)의 헤더와 정확히 일치해야 합니다.
2.  **PK (기본키)**: `설명` 컬럼에 `PK`라고 기재합니다. (자동으로 필수값 인식)
3.  **FK (외래키)**: `FK` 컬럼에 `Y`를 입력하고, **`관계` 컬럼에 대상을 명시**합니다.
4.  **관계 형식**: `참조테이블명:참조컬럼명` 형식을 권장합니다. (예: `전장축선:축선ID`)

---

## 3. 필수 컬럼 상세

| 컬럼명 | 설명 | 입력 예시 |
|:---:|---|---|
| **필드명** | 실제 데이터의 컬럼 이름 | `아군부대ID`, `전투력` |
| **타입** | 데이터 유형 (`string`, `int`, `float`, `date`) | `string` |
| **설명** | 제약조건 및 설명 (PK, 범위, Enum) | `PK, 0~100, 상/중/하` |
| **FK** | 외래키 여부 (`Y` 또는 `N`) | `Y` |
| **관계** | 참조 대상 (FK가 Y일 때 필수) | `부대정보:부대ID` |

### 주요 제약조건 표기법 (`설명` 컬럼)
- **Primary Key**: `PK`
- **필수값**: `필수` 또는 `NOT NULL`
- **값 범위**: `0~100` (숫자형)
- **열거형 (Enum)**: `공격/방어/대기` (슬래시 구분)

---

## 4. 작성 예시

### 예시 1: 아군부대현황

| 필드명 | 타입 | 설명 | FK | 관계 |
|---|---|---|---|---|
| 아군부대ID | string | PK | N | - |
| 부대명 | string | 부대 공식 명칭 | N | - |
| 전투력지수 | int | 0~100 | N | - |
| 배치축선ID | string | 현재 위치 | **Y** | **전장축선:축선ID** |
| 가용상태 | string | 가용/정비/이동 | N | - |

> **해석**:
> - `아군부대ID`는 고유식별자(PK)입니다.
> - `전투력지수`는 0에서 100 사이의 정수만 입력 가능합니다.
> - `배치축선ID`는 `전장축선` 테이블의 `축선ID`를 참조하는 외래키입니다.

### 예시 2: 위협상황

| 필드명 | 타입 | 설명 | FK | 관계 |
|---|---|---|---|---|
| 위협ID | string | PK | N | - |
| 위협유형 | string | 침투/도발/전면전 | N | - |
| 발생위치ID | string | 지형셀 참조 | **Y** | **지형셀:지형셀ID** |

---

## 5. 데이터 검증 및 적용

### 5.1 검증 수행
시스템의 **DATA MANAGEMENT** 페이지 또는 스크립트를 통해 검증할 수 있습니다.

```bash
# 데이터 품질 검증 스크립트 실행
python scripts/validate_data_quality.py
```

### 5.2 온톨로지 반영
테이블정의서를 수정하거나 FK 관계를 변경한 경우, 반드시 **온톨로지를 재생성**해야 합니다.

1.  **DATA MANAGEMENT** 또는 **ONTOLOGY STUDIO** 메뉴 이동
2.  **"온톨로지 그래프 생성/갱신"** 버튼 클릭
3.  로그에서 "FK 관계 생성됨" 메시지 확인

---

**문서 정보**
- **작성일**: 2026-01-26
- **버전**: 2.0
