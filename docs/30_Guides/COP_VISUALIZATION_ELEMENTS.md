# COP 지도 시각화 요소 설명

## 개요
COP(Common Operational Picture) 지도에서 THR001과 같은 위협을 선택했을 때 나타나는 시각적 요소들의 의미를 설명합니다.

## 시각화 요소

### 1. 붉은색 위협 마커 (Red Threat Marker)
- **의미**: 적군 위협의 정확한 위치를 나타내는 MIL-STD-2525D 군사 심볼
- **표시 방식**: 
  - MIL-STD-2525D 표준에 따른 적군 심볼 (예: 기갑, 포병, 보병, 미사일, 항공기 등)
  - 위협 유형에 따라 다른 심볼이 표시됨
- **위치**: 위협이 발생한 실제 지리적 좌표
- **특징**: 
  - 선택된 위협은 더 크게 표시되고 펄스 애니메이션이 적용됨
  - 마커를 클릭하면 상세 정보 팝업이 표시됨
- **반원 붉은색 애니메이션**:
  - **의미**: 선택된 위협을 강조하기 위한 **순수 시각적 표시** (실제 위협 반경과 무관)
  - **표시 조건**: "실제 데이터에서 위협선택" 콤보박스에서 위협을 선택했을 때
  - **반경**: 마커 크기의 절반 + 10px (픽셀 단위, 고정 크기)
    - 예: 50px 마커의 경우 약 35px 반경
    - **주의**: 이는 실제 위협 반경이 아닌 마커 강조용 시각적 요소입니다
  - **애니메이션 효과**: 
    - 마커 주위에 붉은색 원형 테두리가 펄스(확대/축소) 애니메이션으로 표시됨
    - 2초 주기로 반복되는 부드러운 펄스 효과
    - 투명도와 크기가 변화하여 주의를 끔
  - **용도**: 현재 선택된 위협을 명확하게 식별할 수 있도록 시각적으로 강조
  - **실제 위협 반경**: 아래 "반투명 노란색 원" 참조

### 2. 반원 붉은선 (Red Circle Border)
- **의미**: 위협 영향 범위의 경계선
- **표시 방식**: 
  - 위협 마커를 중심으로 한 원형 영역의 테두리
  - 색상: 위협 수준에 따라 결정
    - 80% 이상: 빨간색 (`#ef4444`)
    - 60-80%: 주황색 (`#f97316`)
    - 30-60%: 노란색 (`#eab308`)
    - 30% 미만: 초록색 (`#22c55e`)
- **반경 계산**:
  - 기본 반경: 5km
  - 위협 수준 가중치: 1.0 ~ 2.0
  - 위협 유형별 추가 반경:
    - 미사일: 10km
    - 포병: 8km
    - 기갑: 5km
    - 보병: 3km
    - 공중: 15km
  - 최대 반경: 50km로 제한
- **용도**: 해당 범위 내에서 위협의 영향력이 미치는 영역을 시각적으로 표현

### 3. 반투명 노란색 원 (Semi-transparent Yellow Circle) ⭐ **실제 위협 반경**
- **의미**: 위협 영향 범위의 전체 영역 (위협 영향권) - **실제 위협 반경을 나타냄**
- **표시 방식**:
  - 위협 마커를 중심으로 한 반투명 원형 영역
  - 색상: 위협 수준에 따라 결정 (위의 반원 붉은선과 동일)
  - 투명도: 위협 수준에 따라 결정
    - 80% 이상: 0.3 (30%)
    - 60-80%: 0.2 (20%)
    - 30-60%: 0.15 (15%)
    - 30% 미만: 0.1 (10%)
- **반경 계산** (지도 좌표계, km 단위):
  - 기본 반경: 5km
  - 위협 수준 가중치: 1.0 ~ 2.0
  - 위협 유형별 추가 반경:
    - 미사일: 10km
    - 포병: 8km
    - 기갑: 5km
    - 보병: 3km
    - 공중: 15km
  - 최대 반경: 50km로 제한
  - **지도와 함께 축소/확대됨** (지도 좌표계 사용)
- **특징**:
  - 선택된 위협의 경우 더 진하게 표시됨 (투명도 증가)
  - 선택되지 않은 위협은 더 투명하게 표시됨 (30% 투명도)
  - **이것이 실제 위협의 영향 범위입니다**
- **용도**: 위협이 미치는 실제 영향 범위를 한눈에 파악할 수 있도록 시각화

### 4. 위협정보 박스 (Threat Information Popup)
- **의미**: 위협 마커를 클릭했을 때 표시되는 상세 정보 팝업
- **표시 위치**: 
  - 마커를 클릭한 위치에 표시됨
  - 위협 영향 범위 원 위에 표시됨 (같은 위치에 있기 때문)
- **포함 정보**:
  - 위협 ID (예: THR001)
  - 위협 유형 (기갑, 포병, 보병, 미사일, 항공기 등)
  - 위협 수준 (0-100%)
  - 위협 영향 범위 반경 (km)
  - 심볼 유형 (MIL-STD-2525D 디코딩 결과)
  - SIDC 코드 (원본 코드)
  - 원시 보고 텍스트
- **특징**:
  - 어떤 마커를 클릭하더라도 해당 마커의 정보가 표시됨
  - 위협 영향 범위 원 위에 표시되는 것은 마커와 원이 같은 위치에 있기 때문

## 시각화 우선순위 (Z-Index)

1. **위협 영향 범위 원**: z-index 1000-2000 (선택된 위협은 2000)
2. **위협 마커**: z-index 0-10000 (선택된 위협은 10000)
3. **팝업**: Leaflet 기본 z-index (가장 위에 표시)

## 레이어 토글

사용자는 레이어 토글 컨트롤을 통해 다음 요소들을 켜고 끌 수 있습니다:
- **위협 (Threats)**: 위협 마커 표시/숨김
- **위협 영향 범위 (Threat Influence)**: 위협 영향 범위 원 표시/숨김
- **아군 부대 (Friendly Units)**: 아군 부대 마커 표시/숨김
- **방책 경로 (COA Paths)**: 방책 작전 경로 표시/숨김
- **방책 영역 (COA Areas)**: 방책 작전 영역 표시/숨김
- **축선 (Axes)**: 축선 표시/숨김

## 코드 위치

- **위협 마커 생성**: `frontend/src/components/TacticalMap.tsx` (라인 553-625)
- **위협 영향 범위 생성**: `frontend/src/components/TacticalMap.tsx` (라인 493-550)
- **위협 영향 범위 계산**: `frontend/src/lib/cop-visualization-utils.ts` (라인 100-129)
- **색상 결정**: `frontend/src/lib/cop-visualization-utils.ts` (라인 30-45)

## 줌 레벨에 따른 동작 차이

지도를 확대/축소할 때 각 요소의 동작 방식:

### 픽셀 단위 (고정 크기)
- **붉은색 위협 마커**: 줌 레벨에 관계없이 동일한 픽셀 크기 유지
- **붉은색 애니메이션 원**: 줌 레벨에 관계없이 동일한 픽셀 크기 유지
- **이유**: Leaflet의 Marker는 기본적으로 픽셀 단위로 고정되어 있어, 지도 확대/축소 시에도 일정한 크기를 유지합니다. 이는 마커의 가시성을 보장하기 위한 일반적인 동작입니다.

### 지도 좌표계 (축소/확대)
- **노란색 원형 영역 (위협 영향 범위)**: 지도 좌표계(미터 단위)를 사용하므로 지도와 함께 축소/확대됨
- **이유**: 실제 위협 반경을 나타내므로 지도 스케일과 함께 변화해야 정확한 지리적 범위를 표현할 수 있습니다.

## 참고

- MIL-STD-2525D: 군사 심볼 표준 규격
- 위협 수준: 0.0 (낮음) ~ 1.0 (높음) 범위의 값
- 위협 영향 범위: 위협이 미치는 영향력의 지리적 범위 (km 단위)
- Leaflet Marker: 픽셀 단위로 고정되어 줌 레벨에 관계없이 일정한 크기 유지 (일반적인 동작)
