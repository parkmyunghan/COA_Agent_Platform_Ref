# 온톨로지 추론-방책 추천 연동 장기 개선 과제

## 1. 개요

본 문서는 온톨로지 추론 결과와 방책(COA) 추천 로직의 완전한 통합을 위한 장기 개선 과제를 정의합니다.

**작성일**: 2026-01-22  
**상태**: 미착수 (향후 개선 과제)

---

## 2. 현재 상태

### 2.1 단기 개선 완료 사항 (2026-01-22)
- `EnhancedCOAEvaluator._get_ontology_effectiveness_score()`에 추론 결과 조회 로직 추가
- `ns:적용가능지역` 관계가 현재 축선/지형셀과 일치하면 보너스 점수(최대 0.2) 부여

### 2.2 남아있는 한계점
- 온톨로지 스튜디오에서 규칙을 **수동으로 실행**해야 추론 결과가 그래프에 저장됨
- `InferenceRulesEngine`과 `ReasoningEngine`이 **분리**되어 중복 로직 존재
- COA 생성 시 추론된 전술 관계(`교전대상`, `위협노출`, `협력관계` 등) 미활용

---

## 3. 장기 개선 목표

### 3.1 자동 추론 실행
- COA 생성 요청 시 도메인 규칙을 **자동 실행**하여 최신 추론 결과 반영
- 캐싱 전략: 그래프 변경 시에만 재추론

### 3.2 엔진 통합
```
ReasoningEngine + InferenceRulesEngine → UnifiedReasoningEngine
```
- 정적 규칙(SPARQL CONSTRUCT) + 동적 점수 계산을 **단일 엔진**에서 처리
- 규칙 우선순위 및 의존성 관리

### 3.3 추론 결과 전면 활용
| 추론 결과 | 활용처 |
|-----------|--------|
| `교전대상` | COA 위험도 평가 |
| `위협노출` | 위협 대응 점수 가중치 조정 |
| `화력지원가능` | 자원 가용성 평가 |
| `협력관계` | 부대 할당 최적화 |
| `기동제한` | 기동성 점수 감점 |
| `적용가능지역` | ✅ 구현 완료 (보너스 점수) |

---

## 4. 구현 로드맵

### Phase 1: 자동 추론 트리거 (예상 2일)
- [ ] `COAService.generate_coas_unified()` 시작 시 `InferenceRulesEngine.execute_all_rules()` 호출
- [ ] 추론 결과 캐싱 및 무효화 정책 구현

### Phase 2: 엔진 통합 (예상 3일)
- [ ] `UnifiedReasoningEngine` 클래스 설계
- [ ] 기존 호출부 마이그레이션

### Phase 3: 추론 결과 전면 활용 (예상 4일)
- [ ] `_calculate_threat_response_score()`에 `위협노출` 관계 반영
- [ ] `_calculate_risk_score()`에 `교전대상` 관계 반영
- [ ] `_calculate_mobility_score()`에 `기동제한` 관계 반영

---

## 5. 관련 파일

| 파일 | 역할 |
|------|------|
| `core_pipeline/inference_rules.py` | 도메인 규칙 정의 |
| `core_pipeline/owl_reasoner.py` | OWL-RL 추론 엔진 |
| `core_pipeline/reasoning_engine.py` | 동적 점수 계산 |
| `core_pipeline/coa_engine/coa_evaluator_enhanced.py` | COA 평가 (추론 결과 활용) |
| `api/routers/ontology_studio.py` | 추론 API 엔드포인트 |

---

## 6. 참고 정보

- 도메인 규칙 목록: `TACTICAL_RULES` (14개 규칙)
- 규칙 카테고리: `tactical`, `threat`, `resource`, `coa`
