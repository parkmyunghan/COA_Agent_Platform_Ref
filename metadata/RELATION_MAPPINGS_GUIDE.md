# 관계 매핑 파일 편집 가이드

## 개요

`relation_mappings.json` 파일은 데이터 테이블 간의 관계를 정의하는 설정 파일입니다. 이 파일을 수정하여 온톨로지 그래프에 새로운 관계를 추가할 수 있습니다.

## 파일 위치

```
metadata/relation_mappings.json
```

## 파일 구조

### 기본 구조

```json
{
  "소스테이블명": {
    "컬럼명": "타겟테이블명",
    "추론:관계명": {
      "target": "타겟테이블명",
      "confidence": 0.9,
      "column": "컬럼명"
    }
  }
}
```

### 관계 유형

#### 1. 단순 외래키 관계 (Simple FK Relationship)

소스 테이블의 컬럼이 타겟 테이블을 직접 참조하는 경우:

```json
{
  "전력준비태세": {
    "아군부대명": "아군부대"
  }
}
```

**의미**: `전력준비태세` 테이블의 `아군부대명` 컬럼이 `아군부대` 테이블을 참조합니다.

**생성되는 관계**: `has아군부대`

#### 2. 추론 관계 (Inferred Relationship)

컬럼 값에 기반하여 관계를 추론하는 경우:

```json
{
  "위협상황": {
    "추론:suitableFor": {
      "target": "COA_라이브러리",
      "confidence": 0.9,
      "column": "위협유형"
    }
  }
}
```

**의미**: 
- `위협상황` 테이블의 `위협유형` 컬럼 값을 기반으로
- `COA_라이브러리` 테이블과 `suitableFor` 관계를 생성
- 신뢰도는 0.9 (90%)

**필수 필드**:
- `target`: 타겟 테이블명
- `column`: 관계를 생성하는 데 사용할 컬럼명
- `confidence`: 신뢰도 (0.0 ~ 1.0)

## 실제 예시

### 현재 파일 내용

```json
{
  "위협상황": {
    "추론:suitableFor": {
      "target": "COA_라이브러리",
      "confidence": 0.9,
      "column": "위협유형"
    }
  },
  "적군부대": {
    "추론:relatedTo": {
      "target": "위협상황",
      "confidence": 0.8,
      "column": "부대유형"
    }
  },
  "전력준비태세": {
    "아군부대명": "아군부대"
  },
  "COA_라이브러리": {
    "추론:hasSuitableCOA": {
      "target": "위협상황",
      "confidence": 0.9,
      "column": "키워드"
    }
  }
}
```

## 관계 추가 방법

### 예시 1: 단순 외래키 관계 추가

`정보보고서` 테이블에 `위협ID` 컬럼이 있고, 이것이 `위협상황` 테이블을 참조하는 경우:

```json
{
  "정보보고서": {
    "위협ID": "위협상황"
  }
}
```

### 예시 2: 추론 관계 추가

`아군가용자산` 테이블의 `자산종류` 컬럼을 기반으로 `COA_라이브러리`와 관계를 생성하는 경우:

```json
{
  "아군가용자산": {
    "추론:requiredBy": {
      "target": "COA_라이브러리",
      "confidence": 0.85,
      "column": "자산종류"
    }
  }
}
```

### 예시 3: 여러 관계 추가

하나의 테이블에 여러 관계를 추가하는 경우:

```json
{
  "위협상황": {
    "추론:suitableFor": {
      "target": "COA_라이브러리",
      "confidence": 0.9,
      "column": "위협유형"
    },
    "발생장소": "장소"
  }
}
```

## 주의사항

### 1. JSON 문법 준수
- 모든 문자열은 큰따옴표(`"`)로 감싸야 합니다
- 마지막 항목 뒤에는 쉼표(`,`)를 붙이지 않습니다
- 중괄호(`{}`)와 대괄호(`[]`)의 짝이 맞아야 합니다

### 2. 테이블명 일치
- 소스 테이블명과 타겟 테이블명은 `data_lake/` 폴더의 Excel 파일명과 정확히 일치해야 합니다
- 대소문자와 특수문자(언더스코어, 한글 등)를 정확히 입력해야 합니다

### 3. 컬럼명 일치
- 컬럼명은 실제 Excel 파일의 컬럼명과 정확히 일치해야 합니다
- 공백이나 특수문자도 정확히 입력해야 합니다

### 4. 추론 관계 네이밍
- 추론 관계는 `"추론:"` 접두사를 사용합니다
- 관계명은 영어로 작성하는 것을 권장합니다 (예: `suitableFor`, `relatedTo`)

### 5. 신뢰도 설정
- `confidence` 값은 0.0 ~ 1.0 사이의 숫자입니다
- 높은 신뢰도(0.8 이상): 명확한 관계
- 중간 신뢰도(0.5 ~ 0.8): 추론 가능한 관계
- 낮은 신뢰도(0.5 미만): 불확실한 관계

## 검증 방법

### 1. JSON 문법 검증
JSON 파일을 저장하기 전에 문법 오류가 없는지 확인하세요:
- 온라인 JSON 검증기 사용: https://jsonlint.com/
- 또는 시스템의 검증 기능 사용 (구현 예정)

### 2. 관계 적용 확인
1. 파일을 저장한 후
2. "2단계: 온톨로지 생성" 페이지에서 그래프를 재생성하세요
3. "3단계: 지식그래프 조회" 페이지에서 관계가 올바르게 생성되었는지 확인하세요

### 3. 오류 확인
- 그래프 생성 시 오류가 발생하면 콘솔 로그를 확인하세요
- 테이블명이나 컬럼명이 일치하지 않으면 오류가 발생할 수 있습니다

## 자주 묻는 질문 (FAQ)

### Q1: 관계를 추가했는데 그래프에 반영되지 않아요
**A**: 그래프를 재생성해야 합니다. "2단계: 온톨로지 생성" 페이지에서 "그래프 생성" 버튼을 클릭하세요.

### Q2: 어떤 테이블명을 사용해야 하나요?
**A**: `data_lake/` 폴더의 Excel 파일명을 그대로 사용하세요. 예: `위협상황.xlsx` → `"위협상황"`

### Q3: 컬럼명을 어떻게 확인하나요?
**A**: Excel 파일을 열어서 첫 번째 행(헤더)의 컬럼명을 확인하세요.

### Q4: 추론 관계와 단순 관계의 차이는?
**A**: 
- **단순 관계**: 컬럼 값이 타겟 테이블의 ID와 직접 일치하는 경우
- **추론 관계**: 컬럼 값(예: 위협유형)을 기반으로 관계를 추론하는 경우

### Q5: 신뢰도는 어떻게 설정하나요?
**A**: 
- 명확한 관계: 0.9 ~ 1.0
- 추론 가능한 관계: 0.7 ~ 0.9
- 불확실한 관계: 0.5 ~ 0.7

## 예시 템플릿

### 템플릿 1: 단순 외래키 관계
```json
{
  "테이블명": {
    "컬럼명": "타겟테이블명"
  }
}
```

### 템플릿 2: 추론 관계
```json
{
  "테이블명": {
    "추론:관계명": {
      "target": "타겟테이블명",
      "confidence": 0.9,
      "column": "컬럼명"
    }
  }
}
```

### 템플릿 3: 여러 관계 조합
```json
{
  "테이블명": {
    "컬럼1": "타겟테이블1",
    "추론:관계명": {
      "target": "타겟테이블2",
      "confidence": 0.9,
      "column": "컬럼2"
    }
  }
}
```

## 추가 도움말

문제가 발생하거나 도움이 필요한 경우:
1. 시스템 로그 확인
2. "3단계: 지식그래프 조회" 페이지의 "그래프 분석 및 해석" 섹션 확인
3. 개발팀에 문의

---

**마지막 업데이트**: 2024년
**버전**: 1.0


