# config/sparql_templates.yaml
# COA ì¿¼ë¦¬ í…œí”Œë¦¿ (ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í†µì¼: http://coa-agent-platform.org/ontology#)

find_suitable_coas: |
  PREFIX ns: <http://coa-agent-platform.org/ontology#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  SELECT ?coa ?coaLabel ?coaType ?suitabilityScore ?inferenceType WHERE {
    ?situation ns:hasSuitableCOA ?coa .
    ?coa rdfs:label ?coaLabel .
    ?coa rdf:type ?coaType .
    OPTIONAL {
      ?coa ns:suitabilityScore ?suitabilityScore .
    }
    OPTIONAL {
      ?inference ns:inferredSubject ?situation .
      ?inference ns:inferredObject ?coa .
      ?inference ns:inferenceType ?inferenceType .
    }
    FILTER(?situation = ?situation_uri)
  }
  ORDER BY DESC(?suitabilityScore)
  LIMIT {top_k}

find_coas_by_environment: |
  PREFIX ns: <http://coa-agent-platform.org/ontology#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  SELECT ?coa ?coaLabel ?weather ?terrain WHERE {
    ?situation ns:occursInEnvironment ?weather .
    ?situation ns:occursInEnvironment ?terrain .
    ?coa ns:compatibleWith ?weather .
    ?coa ns:compatibleWith ?terrain .
    ?coa rdfs:label ?coaLabel .
    FILTER(?situation = ?situation_uri)
  }

find_coas_by_resources: |
  PREFIX ns: <http://coa-agent-platform.org/ontology#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  SELECT ?coa ?coaLabel 
         (COUNT(DISTINCT ?requiredResource) AS ?requiredCount)
         (COUNT(DISTINCT ?availableResource) AS ?availableCount)
  WHERE {
    ?coa ns:requiresResource ?requiredResource .
    ?situation ns:hasAvailableResource ?availableResource .
    ?coa rdfs:label ?coaLabel .
    FILTER(?requiredResource = ?availableResource)
    FILTER(?situation = ?situation_uri)
  }
  GROUP BY ?coa ?coaLabel
  HAVING (?availableCount >= ?requiredCount * 0.7)
  ORDER BY DESC(?availableCount)

find_related_threats: |
  PREFIX ns: <http://coa-agent-platform.org/ontology#>
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  SELECT ?threat ?threatType ?severity ?location ?detectionTime ?evidence WHERE {
    ?threat rdf:type ns:ìœ„í˜‘ìƒí™© .
    FILTER(?threat = ?situation_uri)
    OPTIONAL { ?threat ns:ìœ„í˜‘ìœ í˜•ì½”ë“œ ?threatType . }
    OPTIONAL { ?threat ns:ìœ„í˜‘ìœ í˜• ?threatType . }
    OPTIONAL { ?threat rdfs:label ?threatType . }
    OPTIONAL { ?threat ns:ì‹¬ê°ë„ ?severity . }
    OPTIONAL { ?threat ns:ë°œìƒì¥ì†Œ ?location . }
    OPTIONAL { ?threat ns:íƒì§€ì‹œê° ?detectionTime . }
    OPTIONAL { ?threat ns:ê·¼ê±° ?evidence . }
  }

find_available_resources: |
  PREFIX ns: <http://coa-agent-platform.org/ontology#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  SELECT DISTINCT ?resource ?resourceType ?resourceLabel ?quantity ?ìì‚°ì¢…ë¥˜ WHERE {
    {
      # ì§ì ‘ ì—°ê²°ëœ ê°€ìš© ìì›
      { ?situation ns:hasAvailableResource ?resource . }
      UNION
      { ?situation ns:hasê°€ìš©ìì› ?resource . }
    } UNION {
      # ğŸ”¥ ê°œì„ : ì•„êµ°ê°€ìš©ìì‚° í…Œì´ë¸” ìš°ì„  í™œìš© (ì •ê·œí™”ëœ ì„¤ê³„, ìš°ì„ ìˆœìœ„ 1)
      ?situation ns:hasì§€í˜•ì…€ ?location .
      { ?resource ns:locatedIn ?location . } UNION { ?resource ns:hasì§€í˜•ì…€ ?location . }
      ?resource rdf:type ns:ì•„êµ°ê°€ìš©ìì‚° .
      ?resource ns:ê°€ìš©ìƒíƒœ "ê°€ìš©" .
      OPTIONAL { ?resource ns:ìì‚°ì¢…ë¥˜ ?ìì‚°ì¢…ë¥˜ . }
    } UNION {
      # ğŸ”¥ ê°œì„ : ì•„êµ°ë¶€ëŒ€í˜„í™©ë„ í•¨ê»˜ ê³ ë ¤ (ê¸°ì¡´ ë¡œì§ ìœ ì§€, ìš°ì„ ìˆœìœ„ 2)
      ?situation ns:hasì§€í˜•ì…€ ?location .
      { ?resource ns:locatedIn ?location . } UNION { ?resource ns:hasì§€í˜•ì…€ ?location . }
      ?resource rdf:type ns:ì•„êµ°ë¶€ëŒ€í˜„í™© .
      ?resource ns:ê°€ìš©ìƒíƒœ "ê°€ìš©" .
    } UNION {
      # ğŸ”¥ NEW: ì¶•ì„  ê¸°ë°˜ ìì› ì¶”ë¡  (ìš°ì„ ìˆœìœ„ 3)
      ?situation ns:hasì „ì¥ì¶•ì„  ?axis .
      { ?resource ns:hasì „ì¥ì¶•ì„  ?axis . } UNION { ?resource ns:locatedIn ?axis . }
      { 
        ?resource rdf:type ns:ì•„êµ°ê°€ìš©ìì‚° . 
        ?resource ns:ê°€ìš©ìƒíƒœ "ê°€ìš©" .
        OPTIONAL { ?resource ns:ìì‚°ì¢…ë¥˜ ?ìì‚°ì¢…ë¥˜ . }
      }
      UNION
      { ?resource rdf:type ns:ì•„êµ°ë¶€ëŒ€í˜„í™© . ?resource ns:ê°€ìš©ìƒíƒœ "ê°€ìš©" . }
    }
    ?resource rdf:type ?resourceType .
    OPTIONAL {
      ?resource rdfs:label ?resourceLabel .
    }
    OPTIONAL {
      ?resource ns:ìˆ˜ëŸ‰ ?quantity .
    }
    FILTER(?situation = ?situation_uri)
  }
  ORDER BY ?resourceType

find_required_resources: |
  PREFIX ns: <http://coa-agent-platform.org/ontology#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  SELECT ?resource ?resourceType ?resourceLabel ?quantity WHERE {
    {
      { ?coa ns:requiresResource ?resource . }
      UNION
      { ?coa ns:í•„ìš”ìì› ?resource . }
    }
    ?resource rdf:type ?resourceType .
    OPTIONAL {
      ?resource rdfs:label ?resourceLabel .
    }
    OPTIONAL {
      ?resource ns:ìˆ˜ëŸ‰ ?quantity .
    }
    FILTER(?coa = ?coa_uri)
  }

get_coa_properties: |
  PREFIX ns: <http://coa-agent-platform.org/ontology#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  SELECT ?effectiveness ?risk ?cost ?time ?coaLabel WHERE {
    ?coa ns:effectivenessScore ?effectiveness .
    ?coa ns:riskLevel ?risk .
    ?coa ns:estimatedCost ?cost .
    ?coa ns:estimatedTime ?time .
    ?coa rdfs:label ?coaLabel .
    FILTER(?coa = ?coa_uri)
  }

get_situation_properties: |
  PREFIX ns: <http://coa-agent-platform.org/ontology#>
  SELECT ?urgency ?risk ?timePressure WHERE {
    ?situation ns:urgencyLevel ?urgency .
    ?situation ns:riskLevel ?risk .
    ?situation ns:timePressure ?timePressure .
    FILTER(?situation = ?situation_uri)
  }

list_all_threats: |
  PREFIX ns: <http://coa-agent-platform.org/ontology#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  SELECT ?threat ?threatType ?severity ?location ?detectionTime ?evidence WHERE {
    ?threat rdf:type ns:ìœ„í˜‘ìƒí™© .
    FILTER(CONTAINS(STR(?threat), "ìœ„í˜‘ìƒí™©_"))
    OPTIONAL { ?threat rdfs:label ?threatType . }
    OPTIONAL { ?threat ns:ìœ„í˜‘ìœ í˜•ì½”ë“œ ?threatType . }
    OPTIONAL { ?threat ns:ìœ„í˜‘ìœ í˜• ?threatType . }
    OPTIONAL { ?threat ns:ì‹¬ê°ë„ ?severity . }
    OPTIONAL { ?threat ns:ë°œìƒì¥ì†Œ ?location . }
    OPTIONAL { ?threat ns:íƒì§€ì‹œê° ?detectionTime . }
    OPTIONAL { ?threat ns:ê·¼ê±° ?evidence . }
  }
  ORDER BY ?threat

# ë…¸ë“œ ì •ë³´ ì¡°íšŒ í…œí”Œë¦¿
get_node_properties: |
  PREFIX ns: <http://coa-agent-platform.org/ontology#>
  PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  SELECT ?predicate ?object ?object_label WHERE {
    <{node_uri}> ?predicate ?object .
    OPTIONAL {
      ?object rdfs:label ?object_label .
    }
  }
  ORDER BY ?predicate

get_node_incoming_relations: |
  PREFIX ns: <http://coa-agent-platform.org/ontology#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  SELECT ?source ?predicate ?source_label WHERE {
    ?source ?predicate <{node_uri}> .
    OPTIONAL {
      ?source rdfs:label ?source_label .
    }
  }
  LIMIT 50

get_node_outgoing_relations: |
  PREFIX ns: <http://coa-agent-platform.org/ontology#>
  PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  SELECT ?predicate ?target ?target_label WHERE {
    <{node_uri}> ?predicate ?target .
    FILTER (isIRI(?target))
    OPTIONAL {
      ?target rdfs:label ?target_label .
    }
  }
  LIMIT 50


